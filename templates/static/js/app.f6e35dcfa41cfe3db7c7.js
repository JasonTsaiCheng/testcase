webpackJsonp([1],{"+uEa":function(e,t){},"1LRS":function(e,t){},"2rK/":function(e,t,i){e.exports=i.p+"static/img/orbislogo.7af6b70.png"},"3/K3":function(e,t){},"87lX":function(e,t,i){"use strict";(function(e){var t,a=i("pFYg"),n=i.n(a);
/*!
 * jQuery Form Plugin
 * version: 3.51.0-2014.06.20
 * Requires jQuery v1.5 or later
 * Copyright (c) 2014 M. Alsup
 * Examples and documentation at: http://malsup.com/jquery/form/
 * Project repository: https://github.com/malsup/form
 * Dual licensed under the MIT and GPL licenses.
 * https://github.com/malsup/form#copyright-and-license
 */
t=function(e){var t={};t.fileapi=void 0!==e("<input type='file'/>").get(0).files,t.formdata=void 0!==window.FormData;var i=!!e.fn.prop;function a(t){var i=t.data;t.isDefaultPrevented()||(t.preventDefault(),e(t.target).ajaxSubmit(i))}function r(t){var i=t.target,a=e(i);if(!a.is("[type=submit],[type=image]")){var n=a.closest("[type=submit]");if(0===n.length)return;i=n[0]}var r=this;if(r.clk=i,"image"==i.type)if(void 0!==t.offsetX)r.clk_x=t.offsetX,r.clk_y=t.offsetY;else if("function"==typeof e.fn.offset){var o=a.offset();r.clk_x=t.pageX-o.left,r.clk_y=t.pageY-o.top}else r.clk_x=t.pageX-i.offsetLeft,r.clk_y=t.pageY-i.offsetTop;setTimeout(function(){r.clk=r.clk_x=r.clk_y=null},100)}function o(){if(e.fn.ajaxSubmit.debug){var t="[jquery.form] "+Array.prototype.join.call(arguments,"");window.console&&window.console.log?window.console.log(t):window.opera&&window.opera.postError&&window.opera.postError(t)}}e.fn.attr2=function(){if(!i)return this.attr.apply(this,arguments);var e=this.prop.apply(this,arguments);return e&&e.jquery||"string"==typeof e?e:this.attr.apply(this,arguments)},e.fn.ajaxSubmit=function(a){if(!this.length)return o("ajaxSubmit: skipping submit process - no element selected"),this;var n,r,s,l=this;"function"==typeof a?a={success:a}:void 0===a&&(a={}),n=a.type||this.attr2("method"),(s=(s="string"==typeof(r=a.url||this.attr2("action"))?e.trim(r):"")||window.location.href||"")&&(s=(s.match(/^([^#]+)/)||[])[1]),a=e.extend(!0,{url:s,success:e.ajaxSettings.success,type:n||e.ajaxSettings.type,iframeSrc:/^https/i.test(window.location.href||"")?"javascript:false":"about:blank"},a);var c={};if(this.trigger("form-pre-serialize",[this,a,c]),c.veto)return o("ajaxSubmit: submit vetoed via form-pre-serialize trigger"),this;if(a.beforeSerialize&&!1===a.beforeSerialize(this,a))return o("ajaxSubmit: submit aborted via beforeSerialize callback"),this;var d=a.traditional;void 0===d&&(d=e.ajaxSettings.traditional);var u,p=[],g=this.formToArray(a.semantic,p);if(a.data&&(a.extraData=a.data,u=e.param(a.data,d)),a.beforeSubmit&&!1===a.beforeSubmit(g,this,a))return o("ajaxSubmit: submit aborted via beforeSubmit callback"),this;if(this.trigger("form-submit-validate",[g,this,a,c]),c.veto)return o("ajaxSubmit: submit vetoed via form-submit-validate trigger"),this;var m=e.param(g,d);u&&(m=m?m+"&"+u:u),"GET"==a.type.toUpperCase()?(a.url+=(a.url.indexOf("?")>=0?"&":"?")+m,a.data=null):a.data=m;var h=[];if(a.resetForm&&h.push(function(){l.resetForm()}),a.clearForm&&h.push(function(){l.clearForm(a.includeHidden)}),!a.dataType&&a.target){var _=a.success||function(){};h.push(function(t){var i=a.replaceTarget?"replaceWith":"html";e(a.target)[i](t).each(_,arguments)})}else a.success&&h.push(a.success);if(a.success=function(e,t,i){for(var n=a.context||this,r=0,o=h.length;r<o;r++)h[r].apply(n,[e,t,i||l,l])},a.error){var f=a.error;a.error=function(e,t,i){var n=a.context||this;f.apply(n,[e,t,i,l])}}if(a.complete){var v=a.complete;a.complete=function(e,t){var i=a.context||this;v.apply(i,[e,t,l])}}var b=e("input[type=file]:enabled",this).filter(function(){return""!==e(this).val()}).length>0,y="multipart/form-data",x=l.attr("enctype")==y||l.attr("encoding")==y,w=t.fileapi&&t.formdata;o("fileAPI :"+w);var k,F=(b||x)&&!w;!1!==a.iframe&&(a.iframe||F)?a.closeKeepAlive?e.get(a.closeKeepAlive,function(){k=D(g)}):k=D(g):k=(b||x)&&w?function(t){for(var i=new FormData,r=0;r<t.length;r++)i.append(t[r].name,t[r].value);if(a.extraData){var o=function(t){var i,n,r=e.param(t,a.traditional).split("&"),o=r.length,s=[];for(i=0;i<o;i++)r[i]=r[i].replace(/\+/g," "),n=r[i].split("="),s.push([decodeURIComponent(n[0]),decodeURIComponent(n[1])]);return s}(a.extraData);for(r=0;r<o.length;r++)o[r]&&i.append(o[r][0],o[r][1])}a.data=null;var s=e.extend(!0,{},e.ajaxSettings,a,{contentType:!1,processData:!1,cache:!1,type:n||"POST"});a.uploadProgress&&(s.xhr=function(){var t=e.ajaxSettings.xhr();return t.upload&&t.upload.addEventListener("progress",function(e){var t=0,i=e.loaded||e.position,n=e.total;e.lengthComputable&&(t=Math.ceil(i/n*100)),a.uploadProgress(e,i,n,t)},!1),t});s.data=null;var l=s.beforeSend;return s.beforeSend=function(e,t){a.formData?t.data=a.formData:t.data=i,l&&l.call(this,e,t)},e.ajax(s)}(g):e.ajax(a),l.removeData("jqxhr").data("jqxhr",k);for(var S=0;S<p.length;S++)p[S]=null;return this.trigger("form-submit-notify",[this,a]),this;function D(t){var r,s,c,d,u,g,m,h,_,f,v,b,y=l[0],x=e.Deferred();if(x.abort=function(e){h.abort(e)},t)for(s=0;s<p.length;s++)r=e(p[s]),i?r.prop("disabled",!1):r.removeAttr("disabled");if((c=e.extend(!0,{},e.ajaxSettings,a)).context=c.context||c,u="jqFormIO"+(new Date).getTime(),c.iframeTarget?(f=(g=e(c.iframeTarget)).attr2("name"))?u=f:g.attr2("name",u):(g=e('<iframe name="'+u+'" src="'+c.iframeSrc+'" />')).css({position:"absolute",top:"-1000px",left:"-1000px"}),m=g[0],h={aborted:0,responseText:null,responseXML:null,status:0,statusText:"n/a",getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){},abort:function(t){var i="timeout"===t?"timeout":"aborted";o("aborting upload... "+i),this.aborted=1;try{m.contentWindow.document.execCommand&&m.contentWindow.document.execCommand("Stop")}catch(e){}g.attr("src",c.iframeSrc),h.error=i,c.error&&c.error.call(c.context,h,i,t),d&&e.event.trigger("ajaxError",[h,c,i]),c.complete&&c.complete.call(c.context,h,i)}},(d=c.global)&&0==e.active++&&e.event.trigger("ajaxStart"),d&&e.event.trigger("ajaxSend",[h,c]),c.beforeSend&&!1===c.beforeSend.call(c.context,h,c))return c.global&&e.active--,x.reject(),x;if(h.aborted)return x.reject(),x;(_=y.clk)&&(f=_.name)&&!_.disabled&&(c.extraData=c.extraData||{},c.extraData[f]=_.value,"image"==_.type&&(c.extraData[f+".x"]=y.clk_x,c.extraData[f+".y"]=y.clk_y));var w=1,k=2;function F(e){var t=null;try{e.contentWindow&&(t=e.contentWindow.document)}catch(e){o("cannot get iframe.contentWindow document: "+e)}if(t)return t;try{t=e.contentDocument?e.contentDocument:e.document}catch(i){o("cannot get iframe.contentDocument: "+i),t=e.document}return t}var S=e("meta[name=csrf-token]").attr("content"),D=e("meta[name=csrf-param]").attr("content");function C(){var t=l.attr2("target"),i=l.attr2("action"),a=l.attr("enctype")||l.attr("encoding")||"multipart/form-data";y.setAttribute("target",u),n&&!/post/i.test(n)||y.setAttribute("method","POST"),i!=c.url&&y.setAttribute("action",c.url),c.skipEncodingOverride||n&&!/post/i.test(n)||l.attr({encoding:"multipart/form-data",enctype:"multipart/form-data"}),c.timeout&&(b=setTimeout(function(){v=!0,A(w)},c.timeout));var r=[];try{if(c.extraData)for(var s in c.extraData)c.extraData.hasOwnProperty(s)&&(e.isPlainObject(c.extraData[s])&&c.extraData[s].hasOwnProperty("name")&&c.extraData[s].hasOwnProperty("value")?r.push(e('<input type="hidden" name="'+c.extraData[s].name+'">').val(c.extraData[s].value).appendTo(y)[0]):r.push(e('<input type="hidden" name="'+s+'">').val(c.extraData[s]).appendTo(y)[0]));c.iframeTarget||g.appendTo("body"),m.attachEvent?m.attachEvent("onload",A):m.addEventListener("load",A,!1),setTimeout(function e(){try{var t=F(m).readyState;o("state = "+t),t&&"uninitialized"==t.toLowerCase()&&setTimeout(e,50)}catch(e){o("Server abort: ",e," (",e.name,")"),A(k),b&&clearTimeout(b),b=void 0}},15);try{y.submit()}catch(e){document.createElement("form").submit.apply(y)}}finally{y.setAttribute("action",i),y.setAttribute("enctype",a),t?y.setAttribute("target",t):l.removeAttr("target"),e(r).remove()}}D&&S&&(c.extraData=c.extraData||{},c.extraData[D]=S),c.forceSync?C():setTimeout(C,10);var V,T,$,j=50;function A(t){if(!h.aborted&&!$){if((T=F(m))||(o("cannot access response document"),t=k),t===w&&h)return h.abort("timeout"),void x.reject(h,"timeout");if(t==k&&h)return h.abort("server abort"),void x.reject(h,"error","server abort");if(T&&T.location.href!=c.iframeSrc||v){m.detachEvent?m.detachEvent("onload",A):m.removeEventListener("load",A,!1);var i,a="success";try{if(v)throw"timeout";var n="xml"==c.dataType||T.XMLDocument||e.isXMLDoc(T);if(o("isXml="+n),!n&&window.opera&&(null===T.body||!T.body.innerHTML)&&--j)return o("requeing onLoad callback, DOM not available"),void setTimeout(A,250);var r=T.body?T.body:T.documentElement;h.responseText=r?r.innerHTML:null,h.responseXML=T.XMLDocument?T.XMLDocument:T,n&&(c.dataType="xml"),h.getResponseHeader=function(e){return{"content-type":c.dataType}[e.toLowerCase()]},r&&(h.status=Number(r.getAttribute("status"))||h.status,h.statusText=r.getAttribute("statusText")||h.statusText);var s=(c.dataType||"").toLowerCase(),l=/(json|script|text)/.test(s);if(l||c.textarea){var u=T.getElementsByTagName("textarea")[0];if(u)h.responseText=u.value,h.status=Number(u.getAttribute("status"))||h.status,h.statusText=u.getAttribute("statusText")||h.statusText;else if(l){var p=T.getElementsByTagName("pre")[0],_=T.getElementsByTagName("body")[0];p?h.responseText=p.textContent?p.textContent:p.innerText:_&&(h.responseText=_.textContent?_.textContent:_.innerText)}}else"xml"==s&&!h.responseXML&&h.responseText&&(h.responseXML=L(h.responseText));try{V=I(h,s,c)}catch(e){a="parsererror",h.error=i=e||a}}catch(e){o("error caught: ",e),a="error",h.error=i=e||a}h.aborted&&(o("upload aborted"),a=null),h.status&&(a=h.status>=200&&h.status<300||304===h.status?"success":"error"),"success"===a?(c.success&&c.success.call(c.context,V,"success",h),x.resolve(h.responseText,"success",h),d&&e.event.trigger("ajaxSuccess",[h,c])):a&&(void 0===i&&(i=h.statusText),c.error&&c.error.call(c.context,h,a,i),x.reject(h,"error",i),d&&e.event.trigger("ajaxError",[h,c,i])),d&&e.event.trigger("ajaxComplete",[h,c]),d&&!--e.active&&e.event.trigger("ajaxStop"),c.complete&&c.complete.call(c.context,h,a),$=!0,c.timeout&&clearTimeout(b),setTimeout(function(){c.iframeTarget?g.attr("src",c.iframeSrc):g.remove(),h.responseXML=null},100)}}}var L=e.parseXML||function(e,t){return window.ActiveXObject?((t=new ActiveXObject("Microsoft.XMLDOM")).async="false",t.loadXML(e)):t=(new DOMParser).parseFromString(e,"text/xml"),t&&t.documentElement&&"parsererror"!=t.documentElement.nodeName?t:null},z=e.parseJSON||function(e){return window.eval("("+e+")")},I=function(t,i,a){var n=t.getResponseHeader("content-type")||"",r="xml"===i||!i&&n.indexOf("xml")>=0,o=r?t.responseXML:t.responseText;return r&&"parsererror"===o.documentElement.nodeName&&e.error&&e.error("parsererror"),a&&a.dataFilter&&(o=a.dataFilter(o,i)),"string"==typeof o&&("json"===i||!i&&n.indexOf("json")>=0?o=z(o):("script"===i||!i&&n.indexOf("javascript")>=0)&&e.globalEval(o)),o};return x}},e.fn.ajaxForm=function(t){if((t=t||{}).delegation=t.delegation&&e.isFunction(e.fn.on),!t.delegation&&0===this.length){var i={s:this.selector,c:this.context};return!e.isReady&&i.s?(o("DOM not ready, queuing ajaxForm"),e(function(){e(i.s,i.c).ajaxForm(t)}),this):(o("terminating; zero elements found by selector"+(e.isReady?"":" (DOM not ready)")),this)}return t.delegation?(e(document).off("submit.form-plugin",this.selector,a).off("click.form-plugin",this.selector,r).on("submit.form-plugin",this.selector,t,a).on("click.form-plugin",this.selector,t,r),this):this.ajaxFormUnbind().bind("submit.form-plugin",t,a).bind("click.form-plugin",t,r)},e.fn.ajaxFormUnbind=function(){return this.unbind("submit.form-plugin click.form-plugin")},e.fn.formToArray=function(i,a){var n=[];if(0===this.length)return n;var r,o,s,l,c,d,u,p,g=this[0],m=this.attr("id"),h=i?g.getElementsByTagName("*"):g.elements;if(h&&!/MSIE [678]/.test(navigator.userAgent)&&(h=e(h).get()),m&&(r=e(':input[form="'+m+'"]').get()).length&&(h=(h||[]).concat(r)),!h||!h.length)return n;for(o=0,u=h.length;o<u;o++)if((l=(d=h[o]).name)&&!d.disabled)if(i&&g.clk&&"image"==d.type)g.clk==d&&(n.push({name:l,value:e(d).val(),type:d.type}),n.push({name:l+".x",value:g.clk_x},{name:l+".y",value:g.clk_y}));else if((c=e.fieldValue(d,!0))&&c.constructor==Array)for(a&&a.push(d),s=0,p=c.length;s<p;s++)n.push({name:l,value:c[s]});else if(t.fileapi&&"file"==d.type){a&&a.push(d);var _=d.files;if(_.length)for(s=0;s<_.length;s++)n.push({name:l,value:_[s],type:d.type});else n.push({name:l,value:"",type:d.type})}else null!==c&&void 0!==c&&(a&&a.push(d),n.push({name:l,value:c,type:d.type,required:d.required}));if(!i&&g.clk){var f=e(g.clk),v=f[0];(l=v.name)&&!v.disabled&&"image"==v.type&&(n.push({name:l,value:f.val()}),n.push({name:l+".x",value:g.clk_x},{name:l+".y",value:g.clk_y}))}return n},e.fn.formSerialize=function(t){return e.param(this.formToArray(t))},e.fn.fieldSerialize=function(t){var i=[];return this.each(function(){var a=this.name;if(a){var n=e.fieldValue(this,t);if(n&&n.constructor==Array)for(var r=0,o=n.length;r<o;r++)i.push({name:a,value:n[r]});else null!==n&&void 0!==n&&i.push({name:this.name,value:n})}}),e.param(i)},e.fn.fieldValue=function(t){for(var i=[],a=0,n=this.length;a<n;a++){var r=this[a],o=e.fieldValue(r,t);null===o||void 0===o||o.constructor==Array&&!o.length||(o.constructor==Array?e.merge(i,o):i.push(o))}return i},e.fieldValue=function(t,i){var a=t.name,n=t.type,r=t.tagName.toLowerCase();if(void 0===i&&(i=!0),i&&(!a||t.disabled||"reset"==n||"button"==n||("checkbox"==n||"radio"==n)&&!t.checked||("submit"==n||"image"==n)&&t.form&&t.form.clk!=t||"select"==r&&-1==t.selectedIndex))return null;if("select"==r){var o=t.selectedIndex;if(o<0)return null;for(var s=[],l=t.options,c="select-one"==n,d=c?o+1:l.length,u=c?o:0;u<d;u++){var p=l[u];if(p.selected){var g=p.value;if(g||(g=p.attributes&&p.attributes.value&&!p.attributes.value.specified?p.text:p.value),c)return g;s.push(g)}}return s}return e(t).val()},e.fn.clearForm=function(t){return this.each(function(){e("input,select,textarea",this).clearFields(t)})},e.fn.clearFields=e.fn.clearInputs=function(t){var i=/^(?:color|date|datetime|email|month|number|password|range|search|tel|text|time|url|week)$/i;return this.each(function(){var a=this.type,n=this.tagName.toLowerCase();i.test(a)||"textarea"==n?this.value="":"checkbox"==a||"radio"==a?this.checked=!1:"select"==n?this.selectedIndex=-1:"file"==a?/MSIE/.test(navigator.userAgent)?e(this).replaceWith(e(this).clone(!0)):e(this).val(""):t&&(!0===t&&/hidden/.test(a)||"string"==typeof t&&e(this).is(t))&&(this.value="")})},e.fn.resetForm=function(){return this.each(function(){("function"==typeof this.reset||"object"==n()(this.reset)&&!this.reset.nodeType)&&this.reset()})},e.fn.enable=function(e){return void 0===e&&(e=!0),this.each(function(){this.disabled=!e})},e.fn.selected=function(t){return void 0===t&&(t=!0),this.each(function(){var i=this.type;if("checkbox"==i||"radio"==i)this.checked=t;else if("option"==this.tagName.toLowerCase()){var a=e(this).parent("select");t&&a[0]&&"select-one"==a[0].type&&a.find("option").selected(!1),this.selected=t}})},e.fn.ajaxSubmit.debug=!1},"function"==typeof define&&i("nErl")?define(["jquery"],t):t(void 0!==e?e:window.Zepto)}).call(t,i("7t+N"))},"8xBN":function(e,t){},BsKT:function(e,t,i){"use strict";(function(e){var a=i("woOf"),n=i.n(a),r=(i("YtJ0"),i("mtWM")),o=i.n(r),s=i("P9l9"),l=i("O2WP"),c=i("u4WU"),d=(i("87lX"),l.a.url);t.a={inject:["reload"],name:"undiagnosed",created:function(){var e=this.$store.state.page_info,t=this.$store.state.flag;if(console.log("flag",t),t)return this.get_patients(1,10),!1;e.page_size&&e.currentPage?(console.log("111122",e.page_size,e.currentPage),this.page_size=e.page_size,this.currentPage=e.currentPage,this.get_patients(e.currentPage,e.page_size)):this.get_patients(1,10)},mounted:function(){var e=window.innerWidth-250;console.log(e),document.getElementById("rightNav").style.width=e+"px"},methods:{reloadFun:function(){this.reload()},refresh:function(){this.reloadFun();this.currentPage=1;var e=this.page_size,t=this.inputVal;this.otherDate?(this.get_patients_by_rules(1,e,this.dateValue,t),console.log("otherdate",1,e)):(this.get_patients_by_rules(1,e,"",t),console.log("total",1,e),console.log("this.currentPage",this.currentPage))},delieverPageAndSize:function(){var e=this.currentPage,t=this.page_size,i={};i.currentPage=e,i.page_size=t,this.$store.commit("rememberPageAndSize",i)},handleSizeChange:function(e){this.$store.commit("changeFlag",!1);var t=e;this.page_size=t,this.currentPage=1;var i=this.currentPage,a=this.inputVal;this.delieverPageAndSize(),console.log(i,t),this.otherDate?(this.get_patients_by_rules(i,t,this.dateValue,a),console.log("otherdate")):(this.get_patients_by_rules(i,t,"",a),console.log("page_size total"))},handleCurrentChange:function(e){this.$store.commit("changeFlag",!1);var t=e,i=this.page_size,a=this.inputVal;console.log(t,i),this.delieverPageAndSize(),this.otherDate?(this.get_patients_by_rules(t,i,this.dateValue,a),console.log("otherdate")):(this.get_patients_by_rules(t,i,"",a),console.log("pagination total"))},turnBlue:function(e){"isActive1"==e.currentTarget.id&&(console.log("isActive1"),this.isActive1=!0,this.isActive4=!1,this.otherDate=!1,this.dateValue="",this.refresh())},get_patients:function(e,t,i,a){var n=this,r=c.a.getCookie("hospital_id");o.a.get(d+"/patients/?p="+e+"&page_size="+t+"&hospital_id="+r+"&ordering=-apply_time&status=0").then(function(e){console.log("response",e),n.tableData=e.data.results,n.totalNum=e.data.count}).catch(function(i){console.log(i),e-=1,o.a.get(d+"/patients/?p="+e+"&page_size="+t+"&hospital_id="+r+"&ordering=-apply_time&status=0").then(function(e){console.log("response",e),n.tableData=e.data.results,n.totalNum=e.data.count})})},get_patients_by_rules:function(e,t,i,a){var n=this,r=c.a.getCookie("hospital_id");console.log("cookie.getCookie",r),o.a.get(d+"/patients/?p="+e+"&page_size="+t+"&ordering=-apply_time&apply_time="+i+"&hospital_id="+r+"&search="+a+"&status=0").then(function(e){console.log(e),n.tableData=e.data.results,n.totalNum=e.data.count}).catch(function(e){console.log(e)})},selectDate:function(){this.isActive1=!1,this.isActive4=!0,this.otherDate=!0;var e=new Date(this.dateValue),t=e.getFullYear(),i=e.getMonth()+1,a=e.getDate();i>=1&&i<=9&&(i="0"+i),a>=0&&a<=9&&(a="0"+a);var n=t+"-"+i+"-"+a;this.dateValue=n,this.currentPage=1;var r=this.inputVal;console.log(this.dateValue),console.log(r),this.get_patients_by_rules(1,this.page_size,n,r)},searchBtn:function(){console.log("searchBtn"),this.currentPage=1,this.get_patients_by_rules(1,this.page_size,this.dateValue,this.inputVal)},formatSex:function(e){return"0"===e.patient_gender?"男":"1"===e.patient_gender?"女":"未知"},formatStatus:function(e){return"0"===e.status?"未诊断":"2"===e.status?"已诊断":"诊断中"},formatButton:function(e){return"1"===e.pic_upload||"0"!==e.pic_upload},handleEdit:function(e,t){var i=t.historyDisease;console.log(i),this.editForm=n()({},t),this.editForm.isFront=!0,i[0]?(console.log("有既往史"),this.editFormVisible=!0,1!==i[0].DM_year&&!0!==i[0].DM_year||(i[0].DM_year=!0),1!==i[0].HPL_year&&!0!==i[0].HPL_year||(i[0].HPL_year=!0),1!==i[0].HTN_year&&!0!==i[0].HTN_year||(i[0].HTN_year=!0),0===i[0].pregnant_weeks&&(i[0].pregnant_weeks=""),this.editFormJwsForm=i[0],this.editFormLeftDiopterValue=i[0].left_diopter,this.editFormRightDiopterValue=i[0].right_diopter,this.editForm.jwsExist=1,this.editFormjwsVisible=!0,this.radio=3):(console.log("无既往史"),this.editFormVisible=!0,this.editForm.jwsExist=0,this.editFormjwsVisible=!1,this.radio=6)},handleAdd:function(){this.addFormVisible=!0,this.addForm={patient_name:"",patient_gender:0,patient_age:0,patient_tel:"",address:"",jwsRadio:0,genderRadio:0,jwsVisible:!1,jwsExist:""}},checkIsDiagnoseAgain:function(){var e=this,t=n()({},this.addForm);t.username=c.a.getCookie("name"),Object(s.b)(t).then(function(t){console.log(1111,t),"0"==t?console.log("查无此人"):"00"==t?e.$alert("该名患者已经上传照片但是未被诊断，请先诊断","温馨提示",{confirmButtonText:"确定",callback:function(e){console.log(e)}}):(console.log("resres",t),e.$alert("经系统检测，该名患者已存在，确认历史信息无误后可直接提交","温馨提示",{confirmButtonText:"确定",callback:function(i){"cancel"!==i&&(console.log(t),e.addFormVisible=!1,e.editFormVisible=!0,e.editForm=t.fields,t.his_fields?(e.editFormJwsForm=t.his_fields,e.editFormLeftDiopterValue=t.his_fields.left_diopter,e.editFormRightDiopterValue=t.his_fields.right_diopter,e.editForm.jwsExist=1,e.editFormjwsVisible=!0,e.radio=3):(e.radio=6,e.editjws()),e.editForm.patient_id=t.patient_id,e.editForm.diagnose_again="1",e.editForm.isFront=!0,e.$refs.addForm.resetFields())}}))})},addSubmit:function(){var e=this;this.$refs.addForm.validate(function(t){t&&e.$confirm("确认提交吗？","提示",{}).then(function(){e.addLoading=!0,console.log("this.jwsForm",e.jwsForm),console.log(e.leftDiopterValue,e.rightDiopterValue);var t=e.jwsForm,i={};""!==e.leftDiopterValue&&(t.left_diopter=e.leftDiopterValue),""!==e.rightDiopterValue&&(t.right_diopter=e.rightDiopterValue),i.jwsInfo=t,i.basicInfo=e.addForm,console.log("submitInfo",i);var a=n()({},i);a.basicInfo.user_token=c.a.getCookie("token"),console.log("hhhhh",a),Object(s.a)(a).then(function(t){if(e.addLoading=!1,1===t){e.$message({message:"提交成功",type:"success"}),e.$refs.addForm.resetFields(),e.addFormVisible=!1;e.$store.commit("changeFlag",!0),e.refresh()}else e.$message({message:"提交失败",type:"error"})})})})},handleDel:function(e,t){var i=this;this.$confirm("确认删除该记录吗?","提示",{type:"warning"}).then(function(){var e={id:t.patient_id};Object(s.i)(e).then(function(e){console.log(1111,e),0===e?i.$message({message:"删除失败",type:"error"}):(i.$message({message:"删除成功",type:"success"}),i.refresh())})}).catch(function(){})},jwsClick:function(){var e=this.addForm.jwsExist;0===e?(this.addForm.jwsVisible=!1,this.jwsForm={},this.leftDiopterValue="",this.rightDiopterValue=""):1===e&&(this.addForm.jwsVisible=!0)},disabledPregnant:function(){var e=this.addForm.patient_gender;this.pregnant_seen=0===e},handlePregnant:function(){var e=this.editForm.patient_gender;this.pre_seen="0"===e},editjws:function(){var e=this.radio;console.log(e),3===e?(this.editForm.jwsExist=1,this.editFormjwsVisible=!0):6===e&&(this.editFormjwsVisible=!1,this.editFormJwsForm={},this.editFormRightDiopterValue="",this.editFormLeftDiopterValue="",this.editForm.jwsExist=0)},editSubmit:function(){var e=this;this.$refs.editForm.validate(function(t){t&&e.$confirm("确认提交吗？","提示",{}).then(function(){e.editLoading=!0,console.log(123456789);var t=e.editFormJwsForm;console.log("iiiii",e.editForm);var i={};""!==e.editFormLeftDiopterValue&&(t.left_diopter=e.editFormLeftDiopterValue),""!==e.editFormRightDiopterValue&&(t.right_diopter=e.editFormRightDiopterValue),i.jwsInfo=t,i.basicInfo=e.editForm,console.log("13256",i);var a=n()({},i);console.log("para",a),Object(s.d)(a).then(function(t){e.editLoading=!1,1===t?(e.$message({message:"修改成功",type:"success"}),e.$refs.editForm.resetFields(),e.editFormVisible=!1,e.refresh()):e.$message({message:"修改失败",type:"error"})})})})},clickReport:function(e){var t={};t.page_size=this.page_size,t.currentPage=this.currentPage,t.patient_name=e.patient_name,t.patient_gender=e.patient_gender,t.patient_age=e.patient_age,t.patient_id=e.patient_id,t.diagnose_record=e.diagnose_record,t.apply_time=e.apply_time,t.picture=e.picture,t.diagnose=e.diagnose,t.historyDisease=e.historyDisease,t.hospital_id=e.hospital,this.$store.commit("clickReport",t)},clickToDiagnose:function(e,t){var i=this;this.editForm=n()({},t);var a={};a.patient_id=this.editForm.patient_id,a.doctor=c.a.getCookie("name");var r=n()({},a);Object(s.c)(r).then(function(e){console.log(1111,e),0===e?i.$alert("该名患者正在被诊断，您暂时无法诊断","温馨提示",{confirmButtonText:"确定",callback:function(e){console.log(e)}}):i.clickReport(i.editForm)})},uploadPicture:function(e,t){var i=n()({},t);this.upload_id=i.patient_id,this.diagnose_record=i.diagnose_record,document.getElementById("fileToUpload").click()},get_file_num:function(){for(var e=[],t=document.getElementById("fileToUpload").files.length,i=document.getElementById("fileToUpload").files,a=0;a<i.length;a++){if(console.log("1024",i[a].size),i[a].size/1048576>15){e[0]=!1;break}e[0]=!0}return e.push(t),e},uploadPic:function(){var t=this.$loading({lock:!0,text:"AI智能识别左右眼中",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});setTimeout(function(){t.setText("AI智能计算中")},3e3);var i=this.get_file_num()[1],a=this.get_file_num()[0];if(i>2)return this.$alert("单次上传照片数量不可超过两张","温馨提示",{confirmButtonText:"确定",callback:function(e){console.log(e)}}),t.close(),!1;if(!1===a)this.$alert("单张照片大小不可超过10M","温馨提示",{confirmButtonText:"确定",callback:function(e){console.log(e)}}),t.close();else{var n={url:d+"operation/external_upload/",data:{userName:c.a.getCookie("name"),patient_id:this.upload_id,diagnose_record:this.diagnose_record},type:"post",dataType:"json",cache:!1,processData:!1,contentType:!1,success:function(e,i,a){if(console.log("result",e),0===e)t.close(),this.$alert("图片名称不合法,上传失败","温馨提示",{confirmButtonText:"确定",callback:function(e){console.log(e)}});else if(1===e)t.close(),this.$alert("上传失败","温馨提示",{confirmButtonText:"确定",callback:function(e){console.log(e)}});else if("OPSBack:true"===e)t.close(),this.$alert("上传成功","温馨提示",{confirmButtonText:"确定",callback:function(e){console.log(e)}});else if(2===e){t.close();this.$store.commit("changeFlag",!0),this.refresh(),this.$alert("上传成功","温馨提示",{confirmButtonText:"确定",callback:function(e){console.log(e)}})}else t.close(),this.$alert("上传失败","温馨提示",{confirmButtonText:"确定",callback:function(e){console.log(e)}})}.bind(this),error:function(){t.close(),this.$alert("上传成功","温馨提示",{confirmButtonText:"确定",callback:function(e){console.log(e)}})}.bind(this)};e("#jvForm").ajaxSubmit(n)}}},data:function(){var e=function(e,t,i){11!==t.length?i(new Error("手机号为11位")):i()},t=function(e,t,i){t?18!==t.length?i(new Error("中国大陆身份证号为18位")):i():i()},i=function(e,t,i){t.length>10?i(new Error("姓名长度需要小于10个字")):/^[\u4E00-\u9FA5A-Za-z0-9_]+$/.test(t)?i():i(new Error("禁止输入空格等特殊字符"))},a=function(e,t,i){t.length>30?i(new Error("地址长度需要小于30个字")):i()},n=function(e,t,i){t<1?i(new Error("请填写正确年龄")):i()};return{upload_id:"",diagnose_record:0,pregnant_seen:!1,pre_seen:!1,page_info:{},tableData:[],dateValue:"",isActive1:!0,isActive4:!1,currentPage:1,inputVal:"",input:"",page_size:10,totalNum:30,otherDate:!1,pic_upload:!1,editFormjwsVisible:!1,radio:3,pickerOptions:{disabledDate:function(e){return e.getTime()>Date.now()},shortcuts:[{text:"今天",onClick:function(e){e.$emit("pick",new Date)}},{text:"昨天",onClick:function(e){var t=new Date;t.setTime(t.getTime()-864e5),e.$emit("pick",t)}},{text:"一周前",onClick:function(e){var t=new Date;t.setTime(t.getTime()-6048e5),e.$emit("pick",t)}}]},editFormVisible:!1,editLoading:!1,editFormRules:{patient_name:[{required:!0,message:"请输入姓名",trigger:"blur"},{validator:i,trigger:"change"}],patient_tel:[{required:!0,message:"请输入手机号",trigger:"blur"},{validator:e,trigger:"blur"}],ID_number:[{validator:t,trigger:"blur"},{pattern:/(^[1-9]\d{5}(18|19|([23]\d))\d{2}((0[1-9])|(10|11|12))(([0-2][1-9])|10|20|30|31)\d{3}[0-9Xx]$)|(^[1-9]\d{5}\d{2}((0[1-9])|(10|11|12))(([0-2][1-9])|10|20|30|31)\d{2}$)/,message:"证件号码格式有误！",trigger:"blur"}],address:[{validator:a,trigger:"change"}],patient_age:[{required:!0,message:"请输入正确的年龄",trigger:"blur"},{validator:n,trigger:"blur"}]},editForm:{patient_id:0,patient_name:"测试",patient_gender:"0",patient_age:0,patient_tel:18888888888,ID_number:"",birth:"",jwsRadio:0,jwsExist:0,jwsVisible:!1,isFront:!0,address:"",picture:[]},addFormVisible:!1,addLoading:!1,addFormRules:{patient_name:[{required:!0,message:"请输入姓名",trigger:"change"},{validator:i,trigger:"change"}],patient_tel:[{required:!0,message:"请输入手机号",trigger:"change"},{validator:e,trigger:"change"}],ID_number:[{validator:t,trigger:"change"},{pattern:/(^[1-9]\d{5}(18|19|([23]\d))\d{2}((0[1-9])|(10|11|12))(([0-2][1-9])|10|20|30|31)\d{3}[0-9Xx]$)|(^[1-9]\d{5}\d{2}((0[1-9])|(10|11|12))(([0-2][1-9])|10|20|30|31)\d{2}$)/,message:"证件号码格式有误！",trigger:"change"}],jwsExist:[{required:!0,message:"请选择既往史",trigger:"change"}],patient_age:[{required:!0,message:"请输入正确的年龄",trigger:"change"},{validator:n,trigger:"blur"}],address:[{validator:a,trigger:"change"}]},addForm:{patient_id:0,patient_name:"张三",patient_gender:1,patient_age:0,patient_tel:"",address:"",jwsExist:0,jwsVisible:!1,jwsRadio:0,genderRadio:0,ID_number:""},jwsForm:{other:"",DM_year:!1,HTN_year:!1,HPL_year:!1,pregnant_weeks:""},editFormJwsForm:{other:"",DM_year:!1,HTN_year:!1,HPL_year:!1,pregnant_weeks:""},leftDiopter:[{value:"0",label:"正视"},{value:"1",label:"低度近视(75~300)"},{value:"2",label:"中度近视(300~600)"},{value:"3",label:"高度近视(>600)"},{value:"4",label:"远视"}],rightDiopter:[{value:"0",label:"正视"},{value:"1",label:"低度近视(75~300)"},{value:"2",label:"中度近视(300~600)"},{value:"3",label:"高度近视(>600)"},{value:"4",label:"远视"}],editFormLeftDiopter:[{value:"0",label:"正视"},{value:"1",label:"低度近视(75~300)"},{value:"2",label:"中度近视(300~600)"},{value:"3",label:"高度近视(>600)"},{value:"4",label:"远视"}],editFormRightDiopter:[{value:"0",label:"正视"},{value:"1",label:"低度近视(75~300)"},{value:"2",label:"中度近视(300~600)"},{value:"3",label:"高度近视(>600)"},{value:"4",label:"远视"}],leftDiopterValue:"",rightDiopterValue:"",editFormLeftDiopterValue:"",editFormRightDiopterValue:""}}}}).call(t,i("7t+N"))},FS2f:function(e,t,i){e.exports=i.p+"static/img/LOGO.fbd5bc9.png"},NHnr:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i("7+uW"),n=i("Xxa5"),r=i.n(n),o=i("exGp"),s=i.n(o),l=i("YtJ0"),c={name:"orbis_leftNav",store:l.a,methods:{handleOpen:function(e,t){console.log(e,t)},handleClose:function(e,t){console.log(e,t)},add:function(){console.log("add Event from leftNav"),l.a.commit("increase")}},mounted:function(){var e=window.innerHeight;console.log(e),document.getElementById("leftNav").style.height=e+"px"}},d={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"leftNav",attrs:{id:"leftNav"}},[a("el-container",[a("el-header",{staticClass:"logo"},[a("img",{attrs:{id:"logoImg",src:i("2rK/"),alt:""}}),e._v("\n      OrbisBioTech\n    ")])],1),e._v(" "),a("el-container",[a("el-menu",{staticClass:"el-menu-vertical-demo",attrs:{"default-active":"1-1","background-color":"#2F4050","text-color":"#fff"},on:{open:e.handleOpen,close:e.handleClose}},[a("el-submenu",{attrs:{index:"1"}},[a("template",{slot:"title"},[a("i",{staticClass:"icon iconfont icon-yiliao_"}),e._v(" "),a("span",[e._v("眼底筛查系统(V2.0)")])]),e._v(" "),a("el-menu-item",{attrs:{id:"undiagnosed",index:"1-1"},on:{click:function(t){return e.$store.commit("clickUndiagnosed")}}},[e._v("未诊列表")]),e._v(" "),a("el-menu-item",{attrs:{id:"diagnosed",index:"1-2"},on:{click:function(t){return e.$store.commit("clickDiagnosed")}}},[e._v("已诊列表")])],2),e._v(" "),a("el-menu-item",{attrs:{index:"3"},on:{click:function(t){return e.$store.commit("clickTransform")}}},[a("i",{staticClass:"icon iconfont icon-zhuanhuan"}),e._v(" "),a("span",{attrs:{slot:"title"},slot:"title"},[e._v("病患转化")])]),e._v(" "),a("el-menu-item",{attrs:{index:"5"},on:{click:function(t){return e.$store.commit("clickStatistics")}}},[a("i",{staticClass:"icon iconfont icon-shuju1"}),e._v(" "),a("span",{attrs:{slot:"title"},slot:"title"},[e._v("数据统计")])])],1)],1),e._v(" "),a("el-container",[a("el-footer",[a("el-popover",{attrs:{placement:"top-start",title:"关于我们",width:"400",trigger:"hover"}},[a("el-row",[a("el-col",{attrs:{span:24}},[a("i",{staticClass:"el-icon-office-building"}),e._v("  公司:合肥奥比斯科技有限公司")]),e._v(" "),a("el-col",{attrs:{span:24}},[a("i",{staticClass:"el-icon-message"}),e._v("  邮箱:support@orbisbiotech.com")]),e._v(" "),a("el-col",{attrs:{span:24}},[a("i",{staticClass:"el-icon-phone"}),e._v("  电话:0551-63826232")]),e._v(" "),a("el-col",{attrs:{span:24}},[a("i",{staticClass:"el-icon-location"}),e._v("  地址:合肥市高新区黄山路605号")]),e._v(" "),a("el-col",{attrs:{span:24}},[a("i",{staticClass:"el-icon-info"}),e._v("  版本:眼底筛查系统V2.0")])],1),e._v(" "),a("el-button",{staticClass:"about",attrs:{slot:"reference",icon:"el-icon-info"},slot:"reference"},[e._v("关于我们")])],1)],1)],1)],1)},staticRenderFns:[]};var u=i("VU/8")(c,d,!1,function(e){i("1LRS")},"data-v-38b8d3bf",null).exports,p={name:"topHeader",created:function(){var e=this.$store.state.user_info;this.user_info=e,console.log("user_info",e)},methods:{logout:function(){var e=this;this.$confirm("确定退出?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.$store.commit("logout")}).catch(function(e){console.log(e)})}},data:function(){return{user_info:{}}}},g={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"topHeader"},[[t("div",[t("el-row",[t("el-col",{attrs:{span:24}},[t("a",{attrs:{href:"javascript:;"}},[t("i",{staticClass:"el-icon-s-custom",staticStyle:{color:"dodgerblue"}},[this._v(this._s(this.user_info.name))])]),this._v("\n              \n          "),t("a",{attrs:{href:"javascript:;"},on:{click:this.logout}},[t("i",{staticClass:"el-icon-switch-button",staticStyle:{color:"dodgerblue"}},[this._v("退出")])]),this._v("\n              \n        ")])],1)],1)]],2)},staticRenderFns:[]};var m=i("VU/8")(p,g,!1,function(e){i("UG1C")},"data-v-f58dda58",null).exports,h=i("BsKT"),_={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"undiagnosed"},[i("el-row",[i("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[i("el-breadcrumb-item",{attrs:{to:{path:"/"}}},[e._v("PACS")]),e._v(" "),i("el-breadcrumb-item",[e._v("未诊列表")])],1)],1),e._v(" "),i("el-row",{staticClass:"operationNew"},[i("el-col",{class:{active:e.isActive1},attrs:{span:2}},[i("a",{attrs:{id:"isActive1",href:"javascript:;"},on:{click:e.turnBlue}},[e._v("全部")])]),e._v(" "),i("el-col",{staticClass:"timepicker",class:{active:e.isActive4},attrs:{span:3}},[i("a",{attrs:{id:"isActive4",href:"javascript:;"},on:{click:function(e){}}},[i("el-date-picker",{attrs:{align:"right",type:"date",placeholder:"选择日期","picker-options":e.pickerOptions},on:{change:e.selectDate},model:{value:e.dateValue,callback:function(t){e.dateValue=t},expression:"dateValue"}})],1)]),e._v(" "),i("el-col",{attrs:{span:6}},[e._v(" ")]),e._v(" "),i("el-col",{attrs:{span:4}},[i("el-button",{attrs:{type:"primary"},on:{click:e.handleAdd}},[e._v("添加患者"),i("i",{staticClass:"el-icon-upload el-icon--right"})])],1),e._v(" "),i("div",{staticStyle:{"text-align":"center"}},[i("el-col",{attrs:{span:2}},[i("a",{attrs:{href:"javascript:;"},on:{click:e.refresh}},[i("i",{staticClass:"icon iconfont icon-shuaxin1"}),e._v("刷新")])]),e._v(" "),i("el-col",{attrs:{span:5}},[i("el-input",{attrs:{placeholder:"输入患者姓名/手机号/身份证号 可模糊检索"},model:{value:e.inputVal,callback:function(t){e.inputVal=t},expression:"inputVal"}})],1),e._v(" "),i("el-col",{attrs:{span:2}},[i("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.searchBtn}},[e._v("搜索")])],1)],1)],1),e._v(" "),i("el-row",[i("form",{staticStyle:{width:"auto"},attrs:{action:"",method:"POST",id:"jvForm",enctype:"multipart/form-data"}},[i("input",{staticStyle:{display:"none"},attrs:{type:"file",name:"uploadedfile",id:"fileToUpload"},on:{change:e.uploadPic}})])]),e._v(" "),i("el-row",{staticClass:"dataZone"},[[i("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,stripe:""}},[i("el-table-column",{attrs:{prop:"patient_name",label:"姓名"}}),e._v(" "),i("el-table-column",{attrs:{prop:"patient_gender",label:"性别",formatter:e.formatSex}}),e._v(" "),i("el-table-column",{attrs:{prop:"patient_age",label:"年龄"}}),e._v(" "),i("el-table-column",{attrs:{prop:"patient_tel",label:"手机号"}}),e._v(" "),i("el-table-column",{attrs:{prop:"apply_time",label:"录入时间"}}),e._v(" "),i("el-table-column",{attrs:{prop:"status",label:"状态",formatter:e.formatStatus}}),e._v(" "),i("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-tooltip",{attrs:{content:"诊断",placement:"left"}},[e.formatButton(t.row)?i("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-first-aid-kit",circle:""},on:{click:function(i){return e.clickToDiagnose(t.$index,t.row)}}}):e._e()],1),e._v(" "),i("el-tooltip",{attrs:{content:"删除",placement:"left"}},[e.formatButton(t.row)?e._e():i("el-button",{attrs:{type:"danger",size:"small",icon:"el-icon-delete",circle:""},on:{click:function(i){return e.handleDel(t.$index,t.row)}}})],1),e._v(" "),i("el-tooltip",{attrs:{content:"编辑",placement:"right"}},[i("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-edit",circle:""},on:{click:function(i){return e.handleEdit(t.$index,t.row)}}})],1),e._v(" "),i("el-tooltip",{attrs:{content:"上传照片",placement:"right"}},[i("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-upload2",circle:""},on:{click:function(i){return e.uploadPicture(t.$index,t.row)}}})],1)]}}])})],1)]],2),e._v(" "),i("el-row",{staticClass:"pagination"},[i("el-pagination",{attrs:{"current-page":e.currentPage,"page-sizes":[5,10],"page-size":e.page_size,"pager-count":7,layout:"total, sizes, prev, pager, next, jumper",total:e.totalNum},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange,"update:currentPage":function(t){e.currentPage=t},"update:current-page":function(t){e.currentPage=t}}})],1),e._v(" "),i("el-dialog",{attrs:{title:"添加患者",visible:e.addFormVisible,"close-on-click-modal":!1},on:{"update:visible":function(t){e.addFormVisible=t}},model:{value:e.addFormVisible,callback:function(t){e.addFormVisible=t},expression:"addFormVisible"}},[i("el-form",{ref:"addForm",attrs:{model:e.addForm,"label-width":"80px",rules:e.addFormRules}},[i("el-form-item",{staticStyle:{width:"25%"},attrs:{label:"姓名",prop:"patient_name"}},[i("el-input",{attrs:{"auto-complete":"off"},on:{blur:e.checkIsDiagnoseAgain},model:{value:e.addForm.patient_name,callback:function(t){e.$set(e.addForm,"patient_name",t)},expression:"addForm.patient_name"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"手机号",prop:"patient_tel"}},[i("el-input",{staticStyle:{width:"25%"},attrs:{type:"text",placeholder:"手机号",oninput:"value=value.replace(/[^\\d]/g,'')",maxlength:"11","show-word-limit":""},on:{blur:e.checkIsDiagnoseAgain},model:{value:e.addForm.patient_tel,callback:function(t){e.$set(e.addForm,"patient_tel",t)},expression:"addForm.patient_tel"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"年龄",prop:"patient_age"}},[i("el-input-number",{staticStyle:{width:"25%"},attrs:{min:0,max:200},model:{value:e.addForm.patient_age,callback:function(t){e.$set(e.addForm,"patient_age",t)},expression:"addForm.patient_age"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"身份证号",prop:"ID_number"}},[i("el-input",{staticStyle:{width:"25%"},attrs:{type:"text",placeholder:"身份证",oninput:"value=value.replace(/[\\W]/g,'')",maxlength:"18","show-word-limit":""},model:{value:e.addForm.ID_number,callback:function(t){e.$set(e.addForm,"ID_number",t)},expression:"addForm.ID_number"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"性别"}},[i("el-radio-group",{attrs:{onclick:e.disabledPregnant()},model:{value:e.addForm.patient_gender,callback:function(t){e.$set(e.addForm,"patient_gender",t)},expression:"addForm.patient_gender"}},[i("el-radio",{staticClass:"radio",attrs:{label:0},model:{value:e.addForm.genderRadio,callback:function(t){e.$set(e.addForm,"genderRadio",t)},expression:"addForm.genderRadio"}},[e._v("男")]),e._v(" "),i("el-radio",{staticClass:"radio",attrs:{label:1},model:{value:e.addForm.genderRadio,callback:function(t){e.$set(e.addForm,"genderRadio",t)},expression:"addForm.genderRadio"}},[e._v("女")])],1)],1),e._v(" "),i("el-form-item",{attrs:{label:"既往史",prop:"jwsExist"}},[i("el-radio-group",{attrs:{onclick:e.jwsClick()},model:{value:e.addForm.jwsExist,callback:function(t){e.$set(e.addForm,"jwsExist",t)},expression:"addForm.jwsExist"}},[i("el-radio",{staticClass:"radio",attrs:{label:1},model:{value:e.addForm.jwsRadio,callback:function(t){e.$set(e.addForm,"jwsRadio",t)},expression:"addForm.jwsRadio"}},[e._v("有")]),e._v(" "),i("el-radio",{staticClass:"radio",attrs:{label:0},model:{value:e.addForm.jwsRadio,callback:function(t){e.$set(e.addForm,"jwsRadio",t)},expression:"addForm.jwsRadio"}},[e._v("无")])],1),e._v(" "),i("br"),e._v(" "),e.addForm.jwsVisible?i("el-form-item",[i("el-checkbox",{model:{value:e.jwsForm.DM_year,callback:function(t){e.$set(e.jwsForm,"DM_year",t)},expression:"jwsForm.DM_year"}},[e._v("糖尿病")]),e._v(" "),i("el-checkbox",{model:{value:e.jwsForm.HTN_year,callback:function(t){e.$set(e.jwsForm,"HTN_year",t)},expression:"jwsForm.HTN_year"}},[e._v("高血压")]),e._v(" "),i("el-checkbox",{model:{value:e.jwsForm.HPL_year,callback:function(t){e.$set(e.jwsForm,"HPL_year",t)},expression:"jwsForm.HPL_year"}},[e._v("高血脂")]),e._v(" "),i("span",[e._v("        妊娠:")]),i("el-input-number",{attrs:{disabled:e.pregnant_seen,"controls-position":"right",size:"mini",min:0,max:100},model:{value:e.jwsForm.pregnant_weeks,callback:function(t){e.$set(e.jwsForm,"pregnant_weeks",t)},expression:"jwsForm.pregnant_weeks"}}),e._v("周\n              "),i("br"),e._v(" "),i("span",[e._v("其他:   ")]),i("el-input",{staticStyle:{width:"434px"},attrs:{size:"mini",placeholder:"请输入内容(20个字符以内)",maxlength:"20",clearable:""},model:{value:e.jwsForm.other,callback:function(t){e.$set(e.jwsForm,"other",t)},expression:"jwsForm.other"}}),e._v(" "),i("br"),e._v(" "),i("span",[e._v("屈光度:")]),e._v("\n            左眼:"),[i("el-select",{staticStyle:{width:"160px"},attrs:{size:"mini",clearable:"",placeholder:"请选择"},model:{value:e.leftDiopterValue,callback:function(t){e.leftDiopterValue=t},expression:"leftDiopterValue"}},e._l(e.leftDiopter,function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],e._v("\n                      右眼:"),[i("el-select",{staticStyle:{width:"160px"},attrs:{size:"mini",clearable:"",placeholder:"请选择"},model:{value:e.rightDiopterValue,callback:function(t){e.rightDiopterValue=t},expression:"rightDiopterValue"}},e._l(e.rightDiopter,function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)]],2):e._e()],1),e._v(" "),i("br"),e._v(" "),i("el-form-item",{attrs:{label:"地址",prop:"address"}},[i("el-input",{attrs:{type:"textarea"},model:{value:e.addForm.address,callback:function(t){e.$set(e.addForm,"address",t)},expression:"addForm.address"}})],1)],1),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{nativeOn:{click:function(t){e.addFormVisible=!1}}},[e._v("取消")]),e._v(" "),i("el-button",{attrs:{type:"primary",loading:e.addLoading},nativeOn:{click:function(t){return e.addSubmit(t)}}},[e._v("提交")])],1)],1),e._v(" "),i("el-dialog",{attrs:{title:"编辑",visible:e.editFormVisible,"close-on-click-modal":!1},on:{"update:visible":function(t){e.editFormVisible=t}},model:{value:e.editFormVisible,callback:function(t){e.editFormVisible=t},expression:"editFormVisible"}},[i("el-form",{ref:"editForm",attrs:{model:e.editForm,"label-width":"80px",rules:e.editFormRules}},[i("el-form-item",{staticStyle:{width:"25%"},attrs:{label:"姓名",prop:"patient_name"}},[i("el-input",{attrs:{"auto-complete":"off"},model:{value:e.editForm.patient_name,callback:function(t){e.$set(e.editForm,"patient_name",t)},expression:"editForm.patient_name"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"手机号",prop:"patient_tel"}},[i("el-input",{staticStyle:{width:"25%"},attrs:{type:"text",placeholder:"手机号",oninput:"value=value.replace(/[^\\d]/g,'')",maxlength:"11","show-word-limit":""},model:{value:e.editForm.patient_tel,callback:function(t){e.$set(e.editForm,"patient_tel",t)},expression:"editForm.patient_tel"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"年龄",prop:"patient_age"}},[i("el-input-number",{staticStyle:{width:"25%"},attrs:{min:0,max:200},model:{value:e.editForm.patient_age,callback:function(t){e.$set(e.editForm,"patient_age",t)},expression:"editForm.patient_age"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"身份证号",prop:"ID_number"}},[i("el-input",{staticStyle:{width:"25%"},attrs:{type:"text",placeholder:"身份证",oninput:"value=value.replace(/[\\W]/g,'')",maxlength:"18","show-word-limit":""},model:{value:e.editForm.ID_number,callback:function(t){e.$set(e.editForm,"ID_number",t)},expression:"editForm.ID_number"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"性别"}},[i("el-radio-group",{attrs:{onchange:e.handlePregnant()},model:{value:e.editForm.patient_gender,callback:function(t){e.$set(e.editForm,"patient_gender",t)},expression:"editForm.patient_gender"}},[i("el-radio",{staticClass:"radio",attrs:{label:"0"}},[e._v("男")]),e._v(" "),i("el-radio",{staticClass:"radio",attrs:{label:"1"}},[e._v("女")])],1)],1),e._v(" "),i("el-form-item",{attrs:{label:"既往史"}},[[i("el-radio-group",{attrs:{onchange:e.editjws()},model:{value:e.radio,callback:function(t){e.radio=t},expression:"radio"}},[i("el-radio",{attrs:{label:3}},[e._v("有")]),e._v(" "),i("el-radio",{attrs:{label:6}},[e._v("无")])],1)],e._v(" "),i("br"),e._v(" "),e.editFormjwsVisible?i("el-form-item",[i("el-checkbox",{model:{value:e.editFormJwsForm.DM_year,callback:function(t){e.$set(e.editFormJwsForm,"DM_year",t)},expression:"editFormJwsForm.DM_year"}},[e._v("糖尿病")]),e._v(" "),i("el-checkbox",{model:{value:e.editFormJwsForm.HTN_year,callback:function(t){e.$set(e.editFormJwsForm,"HTN_year",t)},expression:"editFormJwsForm.HTN_year"}},[e._v("高血压")]),e._v(" "),i("el-checkbox",{model:{value:e.editFormJwsForm.HPL_year,callback:function(t){e.$set(e.editFormJwsForm,"HPL_year",t)},expression:"editFormJwsForm.HPL_year"}},[e._v("高血脂")]),e._v(" "),i("span",[e._v("        妊娠:")]),i("el-input-number",{attrs:{disabled:e.pre_seen,"controls-position":"right",size:"mini",min:0,max:100},model:{value:e.editFormJwsForm.pregnant_weeks,callback:function(t){e.$set(e.editFormJwsForm,"pregnant_weeks",t)},expression:"editFormJwsForm.pregnant_weeks"}}),e._v("周\n                "),i("br"),e._v(" "),i("span",[e._v("其他:   ")]),i("el-input",{staticStyle:{width:"434px"},attrs:{size:"mini",placeholder:"请输入内容(20个字符以内)",maxlength:"20",clearable:""},model:{value:e.editFormJwsForm.other,callback:function(t){e.$set(e.editFormJwsForm,"other",t)},expression:"editFormJwsForm.other"}}),e._v(" "),i("br"),e._v(" "),i("span",[e._v("屈光度:")]),e._v("\n                左眼:"),[i("el-select",{staticStyle:{width:"160px"},attrs:{size:"mini",clearable:"",placeholder:"请选择"},model:{value:e.editFormLeftDiopterValue,callback:function(t){e.editFormLeftDiopterValue=t},expression:"editFormLeftDiopterValue"}},e._l(e.editFormLeftDiopter,function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],e._v("\n                          右眼:"),[i("el-select",{staticStyle:{width:"160px"},attrs:{size:"mini",clearable:"",placeholder:"请选择"},model:{value:e.editFormRightDiopterValue,callback:function(t){e.editFormRightDiopterValue=t},expression:"editFormRightDiopterValue"}},e._l(e.editFormLeftDiopter,function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)]],2):e._e()],2),e._v(" "),i("br"),e._v(" "),i("el-form-item",{attrs:{label:"地址",prop:"address"}},[i("el-input",{attrs:{type:"textarea"},model:{value:e.editForm.address,callback:function(t){e.$set(e.editForm,"address",t)},expression:"editForm.address"}})],1)],1),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{nativeOn:{click:function(t){e.editFormVisible=!1}}},[e._v("取消")]),e._v(" "),i("el-button",{attrs:{type:"primary",loading:e.editLoading},nativeOn:{click:function(t){return e.editSubmit(t)}}},[e._v("提交")])],1)],1)],1)},staticRenderFns:[]};var f=function(e){i("o0QZ")},v=i("VU/8")(h.a,_,!1,f,"data-v-0d7e2632",null).exports,b=i("woOf"),y=i.n(b),x=i("mtWM"),w=i.n(x),k=i("P9l9"),F=i("u4WU"),S=i("O2WP"),D=S.a.url,C={inject:["reload"],name:"undiagnosed",created:function(){this.get_patients(1,10)},methods:{reloadFun:function(){this.reload()},refresh:function(){this.reloadFun();this.currentPage=1;var e=this.page_size,t=this.inputVal;this.otherDate?(this.get_patients_by_rules(1,e,this.dateValue,t),console.log("otherdate")):(this.get_patients_by_rules(1,e,"",t),console.log("total"))},handleSizeChange:function(e){var t=e;this.page_size=t,this.currentPage=1;var i=this.currentPage,a=this.inputVal;console.log(i,t),this.otherDate?(this.get_patients_by_rules(i,t,this.dateValue,a),console.log("otherdate")):(this.get_patients_by_rules(i,t,"",a),console.log("page_size total"))},handleCurrentChange:function(e){var t=e,i=this.page_size,a=this.inputVal;console.log(t,i),this.otherDate?(this.get_patients_by_rules(t,i,this.dateValue,a),console.log("otherdate")):(this.get_patients_by_rules(t,i,"",a),console.log("pagination total"))},turnBlue:function(e){"isActive1"==e.currentTarget.id&&(console.log("isActive1"),this.isActive1=!0,this.isActive2=!1,this.isActive3=!1,this.isActive4=!1,this.otherDate=!1,this.dateValue="",this.refresh())},get_patients:function(e,t,i,a){var n=this,r=F.a.getCookie("hospital_id");w.a.get(D+"/patients/?p="+e+"&page_size="+t+"&hospital_id="+r+"&ordering=-apply_time&diagnose_record=1").then(function(e){console.log(e.data.results),n.tableData=e.data.results,n.totalNum=e.data.count}).catch(function(e){console.log(e)})},get_patients_by_rules:function(e,t,i,a){var n=this,r=F.a.getCookie("hospital_id");w.a.get(D+"/patients/?p="+e+"&page_size="+t+"&ordering=-apply_time&apply_time="+i+"&hospital_id="+r+"&search="+a+"&diagnose_record=1").then(function(e){console.log(e),n.tableData=e.data.results,n.totalNum=e.data.count}).catch(function(e){console.log(e)})},selectDate:function(){this.isActive1=!1,this.isActive4=!0,this.otherDate=!0;var e=new Date(this.dateValue),t=e.getFullYear(),i=e.getMonth()+1,a=e.getDate();i>=1&&i<=9&&(i="0"+i),a>=0&&a<=9&&(a="0"+a);var n=t+"-"+i+"-"+a;this.dateValue=n,this.currentPage=1;var r=this.inputVal;console.log(this.dateValue),console.log(r),this.get_patients_by_rules(1,this.page_size,n,r)},searchBtn:function(){console.log("searchBtn"),this.currentPage=1,this.get_patients_by_rules(1,this.page_size,this.dateValue,this.inputVal)},formatSex:function(e){return"0"===e.patient_gender?"男":"1"===e.patient_gender?"女":"未知"},formatStatus:function(e){return"0"===e.status?"已诊断":(e.status,"已诊断")},formatTime:function(e){var t=e.diagnose.length-1,i=e.diagnose[t].apply_time;return i||e.diagnose[t-1].apply_time},handleEdit:function(e,t){var i=t.historyDisease;console.log(i),this.editForm=y()({},t),this.editForm.isFront=!0,i[0]?(console.log("有既往史"),this.editFormVisible=!0,1!==i[0].DM_year&&!0!==i[0].DM_year||(i[0].DM_year=!0),1!==i[0].HPL_year&&!0!==i[0].HPL_year||(i[0].HPL_year=!0),1!==i[0].HTN_year&&!0!==i[0].HTN_year||(i[0].HTN_year=!0),0===i[0].pregnant_weeks&&(i[0].pregnant_weeks=""),this.editFormJwsForm=i[0],this.editFormLeftDiopterValue=i[0].left_diopter,this.editFormRightDiopterValue=i[0].right_diopter,this.editForm.jwsExist=1,this.editFormjwsVisible=!0,this.radio=3):(console.log("无既往史"),this.editFormVisible=!0,this.editForm.jwsExist=0,this.editFormjwsVisible=!1,this.radio=6)},editjws:function(){var e=this.radio;console.log(e),3===e?(this.editForm.jwsExist=1,this.editFormjwsVisible=!0):6===e&&(this.editFormjwsVisible=!1,this.editFormJwsForm={},this.editFormRightDiopterValue="",this.editFormLeftDiopterValue="",this.editForm.jwsExist=0)},handlePregnant:function(){var e=this.editForm.patient_gender;this.pregnant_seen="0"===e},editSubmit:function(){var e=this;this.$refs.editForm.validate(function(t){t&&e.$confirm("确认提交吗？","提示",{}).then(function(){e.editLoading=!0,console.log(123456789);var t=e.editFormJwsForm;console.log(e.editForm);var i={};""!==e.editFormLeftDiopterValue&&(t.left_diopter=e.editFormLeftDiopterValue),""!==e.editFormRightDiopterValue&&(t.right_diopter=e.editFormRightDiopterValue),i.jwsInfo=t,i.basicInfo=e.editForm,console.log("13256",i);var a=y()({},i);console.log("para",a),Object(k.d)(a).then(function(t){e.editLoading=!1,e.$message({message:"提交成功",type:"success"}),e.$refs.editForm.resetFields(),e.editFormVisible=!1,e.refresh()})})})},getReportData:function(){var e=this.carouselIndex,t=this.getDiagnoseResult(this.reportForm.diagnose),i={},a={},n={};i.patient_id=this.reportForm.patient_id,i.patient_name=this.reportForm.patient_name,i.patient_gender=this.reportForm.patient_gender,i.patient_age=this.reportForm.patient_age,i.left_diagnose=this.reportForm.diagnose[e].left_diagnose,i.right_diagnose=this.reportForm.diagnose[e].right_diagnose,i.diagnose_time=this.reportForm.diagnose[e].diagnose_time;var r=this.reportForm.diagnose[e].diagnose_advice;i.diagnose_advice=r,a.username=F.a.getCookie("name");var o=document.getElementById("right_origin_src").src,s=document.getElementById("left_origin_src").src,l=o.split("media")[1],c=s.split("media")[1];if(a.right_origin_src=l,a.left_origin_src=c,-1===a.right_origin_src.search("noimg")){var d=a.right_origin_src.lastIndexOf("."),u=a.right_origin_src.substr(d);a.right_AI_src=a.right_origin_src.replace(u,"_AI"+u)}else a.right_AI_src=a.right_origin_src;if(-1===a.left_origin_src.search("noimg")){var p=a.left_origin_src.lastIndexOf("."),g=a.left_origin_src.substr(p);a.left_AI_src=a.left_origin_src.replace(g,"_AI"+g)}else a.left_AI_src=a.left_origin_src;return a.oozed_amount=t[e].oozed_amount,a.bleeding_amount=t[e].bleeding_amount,a.oozed_area=t[e].oozed_area,a.bleeding_area=t[e].bleeding_area,a.max_oozed_area=t[e].max_oozed_area,a.max_bleeding_area=t[e].max_bleeding_area,a.left_iqa_score=t[e].iqa_score_left,a.right_iqa_score=t[e].iqa_score_right,a.other_advice="",n.basic_data=i,n.other_data=a,n},createReport:function(){var e=this,t=this.getReportData();console.log("jkjhkhjkh",t);var i=this.$loading({lock:!0,text:"Loading",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});w.a.post(D+"operation/createPdf/",t).then(function(a){if(i.close(),a.data.length>1){var n=Math.random().toString(36).substr(2),r=window.open("",n,"");r.document.title="pdf";var o=t.basic_data.patient_name,s=t.basic_data.patient_id,l="/media/patient_pdf/"+a.data+"/"+o+"_"+s+".pdf";r.location=l}else e.$alert("诊断报告生成失败","提示",{confirmButtonText:"确定"})}).catch(function(t){i.close(),console.log(t),e.$alert("请允许弹窗","提示",{confirmButtonText:"确定"})})},handleSelectionChange:function(e){this.multipleSelection=e,console.log(e)},batchPdfGen:function(){var e=this;0!==this.multipleSelection.length?this.$confirm("即将批量生成诊断报告, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.sendBatchToServer(),e.nominateZip()}).catch(function(t){console.log(t),e.$message({type:"info",message:"已取消"})}):this.$message({message:"请选择患者",type:"error"})},sendBatchToServer:function(){var e=this,t=this.multipleSelection,i=this.$loading({lock:!0,text:"Loading",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});w.a.post(D+"operation/createPdf/",t).then(function(t){if(console.log("res=>",t.data),t.data.length>5){if(i.close(),confirm("生成成功，是否下载压缩包？")){var a=t.data,n=document.getElementById("downloadzip");n.href=a,n.click()}}else i.close(),e.$alert("诊断报告生成失败","提示",{confirmButtonText:"确定"})}).catch(function(t){console.log(t),i.close(),e.$alert("诊断报告生成失败","提示",{confirmButtonText:"确定"})})},handleView:function(e,t){this.reportFormVisible=!0,this.value=!0,this.reportForm=y()({},t);var i=this.getPictureInfo(t.picture);console.log("picList",this.reportForm.diagnose);var a=this.reportForm.diagnose,n=this.getDiagnoseResult(a);console.log("result",n),this.oozed_bleeding=n,this.picList=i;for(var r=this.picList[0].hospital,o=D+"media/"+r+"/",s=[],l=0;l<this.picList[0].data.length;l++)s.push(o+this.picList[0].data[l]);console.log("1324",s);for(var c=[],d=[],u=0;u<s.length;u++)-1===s[u].search("infrared")?(console.log("2345",s[u]),-1!==s[u].search("Left")?c.push(s[u]):d.push(s[u])):console.log("i find infrared and filter it",s[u]);this.right_srcList=d,this.left_srcList=c,this.right_src=d[0],this.left_src=c[0],0===d.length&&(console.log("右眼眼没有照片"),d[0]=D+"media/noimg.jpg",this.right_src=d[0],this.right_srcList=[]),0===c.length&&(console.log("左眼没有照片"),c[0]=D+"media/noimg.jpg",console.log(c),this.left_src=c[0],this.left_srcList=[])},closeReport:function(){var e=this;setTimeout(function(){e.reportFormVisible=!1},100)},getDiagnoseResult:function(e){for(var t=0;t<e.length;t++)e[t].oozed_area=(10*e[t].left_oozed_area+10*e[t].right_oozed_area)/10,e[t].oozed_amount=parseInt(e[t].left_oozed_amount)+parseInt(e[t].right_oozed_amount),e[t].max_oozed_area=(10*e[t].left_max_oozed_area+10*e[t].right_max_oozed_area)/10,e[t].bleeding_area=(10*e[t].left_bleeding_area+10*e[t].right_bleeding_area)/10,e[t].bleeding_amount=parseInt(e[t].left_bleeding_amount)+parseInt(e[t].right_bleeding_amount),e[t].max_bleeding_area=(10*e[t].left_max_bleeding_area+10*e[t].right_max_bleeding_area)/10,e[t].iqa_score_left=e[t].left_iqa_score<60?"不佳":e[t].left_iqa_score>=75?"良好":"一般",e[t].iqa_score_right=e[t].right_iqa_score<60?"不佳":e[t].right_iqa_score>=75?"良好":"一般";return console.log("一般",e),e},getPictureInfo:function(e){for(var t={},i=[],a=0;a<e.length;a++){var n=e[a],r=n.pic_name,o=n.hospital;if(t[n.own_to])for(var s=0;s<i.length;s++){var l=i[s];if(l.own_to===n.own_to){l.data.push(r);break}}else i.push({own_to:n.own_to,hospital:o,data:[r]}),t[n.own_to]=n}return i},changeCarousel:function(e){this.carouselIndex=e;for(var t=this.picList[e].hospital,i=D+"media/"+t+"/",a=[],n=0;n<this.picList[e].data.length;n++)a.push(i+this.picList[e].data[n]);console.log("1324567",a);for(var r=[],o=[],s=0;s<a.length;s++)-1===a[s].search("infrared")?-1!==a[s].search("Left")?r.push(a[s]):o.push(a[s]):console.log("i find infrared and filter it",a[s]);r=r.reverse(),o=o.reverse(),this.right_src=o[0],this.left_src=r[0],this.right_srcList=o,this.left_srcList=r,0===o.length&&(console.log("右眼眼没有照片"),o[0]=D+"media/noimg.jpg",this.right_src=o[0],this.right_srcList=[]),0===r.length&&(console.log("左眼没有照片"),r[0]=D+"media/noimg.jpg",console.log(r),this.left_src=r[0],this.left_srcList=[])},nominateZip:function(){var e=document.getElementById("downloadzip"),t=this.getNowFormatDate();e.setAttribute("download",t+".zip")},getNowFormatDate:function(){var e=new Date,t=e.getMonth()+1,i=e.getDate();return t>=1&&t<=9&&(t="0"+t),i>=0&&i<=9&&(i="0"+i),e.getFullYear()+""+t+i+"/"+e.getHours()+"_"+e.getMinutes()+"_"+e.getSeconds()}},data:function(){return{carouselIndex:0,pregnant_seen:!1,oozed_bleeding:[],picList:[],tableData:[],multipleSelection:[],dateValue:"",isActive1:!0,isActive2:!1,isActive3:!1,isActive4:!1,currentPage:1,inputVal:"",value:!0,page_size:10,totalNum:30,otherDate:!1,pickerOptions:{disabledDate:function(e){return e.getTime()>Date.now()},shortcuts:[{text:"今天",onClick:function(e){e.$emit("pick",new Date)}},{text:"昨天",onClick:function(e){var t=new Date;t.setTime(t.getTime()-864e5),e.$emit("pick",t)}},{text:"一周前",onClick:function(e){var t=new Date;t.setTime(t.getTime()-6048e5),e.$emit("pick",t)}}]},editFormVisible:!1,reportFormVisible:!1,editLoading:!1,editFormRules:{patient_name:[{required:!0,message:"请输入姓名",trigger:"change"},{validator:function(e,t,i){t.length>10?i(new Error("姓名长度需要小于10个字")):/^[\u4E00-\u9FA5A-Za-z0-9_]+$/.test(t)?i():i(new Error("禁止输入空格等特殊字符"))},trigger:"change"}],patient_tel:[{required:!0,message:"请输入手机号",trigger:"change"},{validator:function(e,t,i){11!==t.length?i(new Error("手机号为11位")):i()},trigger:"change"}],patient_age:[{required:!0,message:"请输入正确的年龄",trigger:"blur"},{validator:function(e,t,i){t<1?i(new Error("请填写正确年龄")):i()},trigger:"blur"}],ID_number:[{validator:function(e,t,i){t&&18!==t.length?i(new Error("中国大陆身份证号为18位")):i()},trigger:"change"},{pattern:/(^[1-9]\d{5}(18|19|([23]\d))\d{2}((0[1-9])|(10|11|12))(([0-2][1-9])|10|20|30|31)\d{3}[0-9Xx]$)|(^[1-9]\d{5}\d{2}((0[1-9])|(10|11|12))(([0-2][1-9])|10|20|30|31)\d{2}$)/,message:"证件号码格式有误！",trigger:"change"}],address:[{validator:function(e,t,i){t.length>30?i(new Error("地址长度需要小于30个字")):i()},trigger:"change"}]},editForm:{patient_id:0,patient_name:"测试",patient_gender:"0",patient_age:0,patient_tel:18888888888,ID_number:"",birth:"",jwsRadio:0,jwsExist:0,jwsVisible:!1,isFront:!0,address:""},editFormJwsForm:{other:"",DM_year:"",HTN_year:"",HPL_year:"",pregnant_weeks:""},radio:3,reportForm:{patient_id:0,patient_name:"测试",patient_gender:"0",patient_age:0,patient_tel:18888888888,address:"",diagnose:[]},editFormLeftDiopter:[{value:"0",label:"正视"},{value:"1",label:"低度近视(75~300)"},{value:"2",label:"中度近视(300~600)"},{value:"3",label:"高度近视(>600)"},{value:"4",label:"远视"}],editFormRightDiopter:[{value:"0",label:"正视"},{value:"1",label:"低度近视(75~300)"},{value:"2",label:"中度近视(300~600)"},{value:"3",label:"高度近视(>600)"},{value:"4",label:"远视"}],editFormLeftDiopterValue:"",editFormRightDiopterValue:"",left_src:"",right_src:"",left_srcList:[],right_srcList:[]}}},V={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"undiagnosed",attrs:{id:"diagnosedPage"}},[i("el-row",[i("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[i("el-breadcrumb-item",{attrs:{to:{path:"/"}}},[e._v("PACS")]),e._v(" "),i("el-breadcrumb-item",[e._v("已诊列表")])],1)],1),e._v(" "),i("el-row",{staticClass:"operationNew"},[i("el-col",{class:{active:e.isActive1},attrs:{span:2}},[i("a",{attrs:{id:"isActive1",href:"javascript:;"},on:{click:e.turnBlue}},[e._v("全部")])]),e._v(" "),i("el-col",{staticClass:"timepicker",class:{active:e.isActive4},attrs:{span:3}},[i("a",{attrs:{id:"isActive4",href:"javascript:;"},on:{click:function(e){}}},[i("el-date-picker",{attrs:{align:"right",type:"date",placeholder:"选择日期","picker-options":e.pickerOptions},on:{change:e.selectDate},model:{value:e.dateValue,callback:function(t){e.dateValue=t},expression:"dateValue"}})],1)]),e._v(" "),i("el-col",{attrs:{span:6}},[e._v(" ")]),e._v(" "),i("el-col",{attrs:{span:4}},[i("el-button",{attrs:{type:"primary"},on:{click:e.batchPdfGen}},[e._v("批量生成报告"),i("i",{staticClass:"el-icon-printer el-icon--right"})])],1),e._v(" "),i("div",{staticStyle:{"text-align":"center"}},[i("el-col",{attrs:{span:2}},[i("a",{attrs:{href:"javascript:;"},on:{click:e.refresh}},[i("i",{staticClass:"icon iconfont icon-shuaxin1"}),e._v("刷新")]),e._v(" "),i("a",{staticStyle:{display:"none"},attrs:{id:"downloadzip",href:"",download:"Re.zip"}},[e._v("Download file")])]),e._v(" "),i("el-col",{attrs:{span:5}},[i("el-input",{attrs:{placeholder:"输入患者姓名/手机号/身份证号 可模糊检索"},model:{value:e.inputVal,callback:function(t){e.inputVal=t},expression:"inputVal"}})],1),e._v(" "),i("el-col",{attrs:{span:2}},[i("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.searchBtn}},[e._v("搜索")])],1)],1)],1),e._v(" "),i("el-row",{staticClass:"dataZone"},[[i("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:e.tableData,stripe:""},on:{"selection-change":e.handleSelectionChange}},[i("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),i("el-table-column",{attrs:{prop:"patient_name",label:"姓名"}}),e._v(" "),i("el-table-column",{attrs:{prop:"patient_gender",label:"性别",formatter:e.formatSex}}),e._v(" "),i("el-table-column",{attrs:{prop:"patient_age",label:"年龄"}}),e._v(" "),i("el-table-column",{attrs:{prop:"patient_tel",label:"手机号"}}),e._v(" "),i("el-table-column",{attrs:{prop:"apply_time",label:"录入时间",formatter:e.formatTime}}),e._v(" "),i("el-table-column",{attrs:{prop:"status",label:"状态",formatter:e.formatStatus}}),e._v(" "),i("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-tooltip",{attrs:{content:"查看报告",placement:"left"}},[i("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-view",circle:""},on:{click:function(i){return e.handleView(t.$index,t.row)}}})],1),e._v(" "),i("el-tooltip",{attrs:{content:"编辑",placement:"right"}},[i("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-edit",circle:""},on:{click:function(i){return e.handleEdit(t.$index,t.row)}}})],1)]}}])})],1)]],2),e._v(" "),i("el-row",{staticClass:"pagination"},[i("el-pagination",{attrs:{"current-page":e.currentPage,"page-sizes":[5,10],"page-size":e.page_size,"pager-count":7,layout:"total, sizes, prev, pager, next, jumper",total:e.totalNum},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange,"update:currentPage":function(t){e.currentPage=t},"update:current-page":function(t){e.currentPage=t}}})],1),e._v(" "),i("el-dialog",{attrs:{title:"编辑",visible:e.editFormVisible,"close-on-click-modal":!1},on:{"update:visible":function(t){e.editFormVisible=t}},model:{value:e.editFormVisible,callback:function(t){e.editFormVisible=t},expression:"editFormVisible"}},[i("el-form",{ref:"editForm",attrs:{model:e.editForm,"label-width":"80px",rules:e.editFormRules}},[i("el-form-item",{staticStyle:{width:"25%"},attrs:{label:"姓名",prop:"patient_name"}},[i("el-input",{attrs:{"auto-complete":"off"},model:{value:e.editForm.patient_name,callback:function(t){e.$set(e.editForm,"patient_name",t)},expression:"editForm.patient_name"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"手机号",prop:"patient_tel"}},[i("el-input",{staticStyle:{width:"25%"},attrs:{type:"text",placeholder:"手机号",oninput:"value=value.replace(/[^\\d]/g,'')",maxlength:"11","show-word-limit":""},model:{value:e.editForm.patient_tel,callback:function(t){e.$set(e.editForm,"patient_tel",t)},expression:"editForm.patient_tel"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"年龄",prop:"patient_age"}},[i("el-input-number",{staticStyle:{width:"25%"},attrs:{oninput:"value=value.replace(/[^\\d]/g,'')",min:0,max:200},model:{value:e.editForm.patient_age,callback:function(t){e.$set(e.editForm,"patient_age",t)},expression:"editForm.patient_age"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"身份证号",prop:"ID_number"}},[i("el-input",{staticStyle:{width:"25%"},attrs:{type:"text",placeholder:"身份证",oninput:"value=value.replace(/[\\W]/g,'')",maxlength:"18","show-word-limit":""},model:{value:e.editForm.ID_number,callback:function(t){e.$set(e.editForm,"ID_number",t)},expression:"editForm.ID_number"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"性别"}},[i("el-radio-group",{attrs:{onclick:e.handlePregnant()},model:{value:e.editForm.patient_gender,callback:function(t){e.$set(e.editForm,"patient_gender",t)},expression:"editForm.patient_gender"}},[i("el-radio",{staticClass:"radio",attrs:{label:"0"}},[e._v("男")]),e._v(" "),i("el-radio",{staticClass:"radio",attrs:{label:"1"}},[e._v("女")])],1)],1),e._v(" "),i("el-form-item",{attrs:{label:"既往史"}},[[i("el-radio-group",{attrs:{onchange:e.editjws()},model:{value:e.radio,callback:function(t){e.radio=t},expression:"radio"}},[i("el-radio",{attrs:{label:3}},[e._v("有")]),e._v(" "),i("el-radio",{attrs:{label:6}},[e._v("无")])],1)],e._v(" "),i("br"),e._v(" "),e.editFormjwsVisible?i("el-form-item",[i("el-checkbox",{model:{value:e.editFormJwsForm.DM_year,callback:function(t){e.$set(e.editFormJwsForm,"DM_year",t)},expression:"editFormJwsForm.DM_year"}},[e._v("糖尿病")]),e._v(" "),i("el-checkbox",{model:{value:e.editFormJwsForm.HTN_year,callback:function(t){e.$set(e.editFormJwsForm,"HTN_year",t)},expression:"editFormJwsForm.HTN_year"}},[e._v("高血压")]),e._v(" "),i("el-checkbox",{model:{value:e.editFormJwsForm.HPL_year,callback:function(t){e.$set(e.editFormJwsForm,"HPL_year",t)},expression:"editFormJwsForm.HPL_year"}},[e._v("高血脂")]),e._v(" "),i("span",[e._v("   妊娠:")]),i("el-input-number",{attrs:{disabled:e.pregnant_seen,"controls-position":"right",size:"mini",min:0,max:100},model:{value:e.editFormJwsForm.pregnant_weeks,callback:function(t){e.$set(e.editFormJwsForm,"pregnant_weeks",t)},expression:"editFormJwsForm.pregnant_weeks"}}),e._v("周\n            "),i("br"),e._v(" "),i("span",[e._v("其他:   ")]),i("el-input",{staticStyle:{width:"410px"},attrs:{size:"mini",placeholder:"请输入内容(20个字符以内)",maxlength:"20",clearable:""},model:{value:e.editFormJwsForm.other,callback:function(t){e.$set(e.editFormJwsForm,"other",t)},expression:"editFormJwsForm.other"}}),e._v(" "),i("br"),e._v(" "),i("span",[e._v("屈光度:")]),e._v("\n            左眼:"),[i("el-select",{staticStyle:{width:"160px"},attrs:{size:"mini",clearable:"",placeholder:"请选择"},model:{value:e.editFormLeftDiopterValue,callback:function(t){e.editFormLeftDiopterValue=t},expression:"editFormLeftDiopterValue"}},e._l(e.editFormLeftDiopter,function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],e._v("\n                右眼:"),[i("el-select",{staticStyle:{width:"160px"},attrs:{size:"mini",clearable:"",placeholder:"请选择"},model:{value:e.editFormRightDiopterValue,callback:function(t){e.editFormRightDiopterValue=t},expression:"editFormRightDiopterValue"}},e._l(e.editFormLeftDiopter,function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)]],2):e._e()],2),e._v(" "),i("br"),e._v(" "),i("el-form-item",{attrs:{label:"地址",prop:"address"}},[i("el-input",{attrs:{type:"textarea"},model:{value:e.editForm.address,callback:function(t){e.$set(e.editForm,"address",t)},expression:"editForm.address"}})],1)],1),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{nativeOn:{click:function(t){e.editFormVisible=!1}}},[e._v("取消")]),e._v(" "),i("el-button",{attrs:{type:"primary",loading:e.editLoading},nativeOn:{click:function(t){return e.editSubmit(t)}}},[e._v("提交")])],1)],1),e._v(" "),e.reportFormVisible?i("el-carousel",{staticStyle:{width:"800px",position:"fixed","z-index":"99",left:"30%",top:"1%",bottom:"1%"},attrs:{interval:1e6,height:"800px",loop:!1},on:{change:e.changeCarousel}},e._l(this.reportForm.diagnose,function(t,a){return i("el-carousel-item",{key:t.id},[i("el-row",{staticStyle:{"text-align":"center","font-weight":"bold","font-size":"x-large","margin-top":"10px"}},[i("el-col",{attrs:{span:5}},[e._v(" ")]),e._v(" "),i("el-col",{attrs:{span:14,id:"report"}},[e._v("诊断报告"),i("span",{staticStyle:{"font-weight":"unset","font-size":"small"}},[e._v("(序号:"+e._s(a+1)+"/"+e._s(e.reportForm.diagnose.length)+")")])]),e._v(" "),i("el-col",{staticStyle:{"text-align":"right"},attrs:{span:5}},[i("el-tooltip",{attrs:{content:"关闭",placement:"left"}},[i("a",{attrs:{href:"javascript:;"},on:{click:e.closeReport}},[i("i",{staticClass:"el-icon-circle-close"})])]),e._v("\n             \n")],1)],1),e._v(" "),i("el-row",{staticStyle:{"margin-top":"20px"}},[i("el-col",{attrs:{span:1}},[e._v(" ")]),e._v(" "),i("el-col",{attrs:{span:5}},[e._v("姓名:"+e._s(e.reportForm.patient_name))]),e._v(" "),"0"===e.reportForm.patient_gender?i("el-col",{attrs:{span:5}},[e._v("性别:男")]):i("el-col",{attrs:{span:5}},[e._v("性别:女")]),e._v(" "),i("el-col",{attrs:{span:6}},[e._v("年龄:"+e._s(e.reportForm.patient_age))]),e._v(" "),i("el-col",{attrs:{span:7}},[e._v("诊断日期:"+e._s(e.reportForm.diagnose[a].diagnose_time))])],1),e._v(" "),i("el-row",{staticStyle:{"margin-top":"20px"}},[i("el-col",{staticStyle:{"text-align":"center"},attrs:{span:12}},[e._v("OD(图像质量:"+e._s(e.reportForm.diagnose[a].iqa_score_right)+")")]),e._v(" "),i("el-col",{staticStyle:{"text-align":"center"},attrs:{span:12}},[e._v("OS(图像质量:"+e._s(e.reportForm.diagnose[a].iqa_score_left)+")")])],1),e._v(" "),i("el-row",{staticStyle:{"margin-top":"30px"}},[i("el-col",{staticStyle:{"text-align":"center"},attrs:{span:12}},[i("div",{staticClass:"demo-image__preview"},[i("el-image",{staticStyle:{height:"250px"},attrs:{id:"right_origin_src",src:e.right_src,"preview-src-list":e.right_srcList}})],1)]),e._v(" "),i("el-col",{staticStyle:{"text-align":"center"},attrs:{span:12}},[i("div",{staticClass:"demo-image__preview"},[i("el-image",{staticStyle:{height:"250px"},attrs:{id:"left_origin_src",src:e.left_src,"preview-src-list":e.left_srcList}})],1)])],1),e._v(" "),i("el-row",{staticStyle:{"margin-top":"40px","font-weight":"bold","font-size":"large"}},[i("el-col",{attrs:{span:1}},[e._v(" ")]),e._v(" "),i("el-col",{attrs:{span:4}},[e._v("诊断")]),e._v(" "),i("el-col",{attrs:{span:19}})],1),e._v(" "),i("el-row",{staticStyle:{"margin-top":"10px"}},[i("el-col",{attrs:{span:1}},[e._v(" ")]),e._v(" "),i("el-col",{attrs:{span:21,id:"right_diagnose"}},[e._v("右眼:  "+e._s(e.reportForm.diagnose[a].right_diagnose))]),e._v(" "),i("el-col",{attrs:{span:2}})],1),e._v(" "),i("el-row",{staticStyle:{"margin-top":"10px"}},[i("el-col",{attrs:{span:1}},[e._v(" ")]),e._v(" "),i("el-col",{attrs:{span:21,id:"left_diagnose"}},[e._v("左眼:  "+e._s(e.reportForm.diagnose[a].left_diagnose))]),e._v(" "),i("el-col",{attrs:{span:2}})],1),e._v(" "),i("el-row",{staticStyle:{"margin-top":"20px","font-weight":"bold","font-size":"large"}},[i("el-col",{attrs:{span:1}},[e._v(" ")]),e._v(" "),i("el-col",{attrs:{span:23}},[e._v("建议:")])],1),e._v(" "),i("el-row",{staticStyle:{"margin-top":"10px","font-size":"large"},attrs:{id:"diagnose_advice"}},[i("el-col",{attrs:{span:1}},[e._v(" ")]),e._v(" "),e.reportForm.diagnose[a].review_time?i("el-col",{attrs:{span:23}},[e._v("请于"+e._s(e.reportForm.diagnose[a].review_time)+"前复诊")]):i("el-col",{attrs:{span:23}},[e._v(e._s(e.reportForm.diagnose[a].diagnose_advice))])],1),e._v(" "),i("el-row",{staticStyle:{"margin-top":"140px","font-size":"large"}},[i("el-col",{staticStyle:{"text-align":"center"},attrs:{span:24}},[i("el-button",{attrs:{round:""},on:{click:e.createReport}},[e._v("生成pdf报告")])],1)],1)],1)}),1):e._e()],1)},staticRenderFns:[]};var T=i("VU/8")(C,V,!1,function(e){i("3/K3")},"data-v-6fc51196",null).exports,$=S.a.url,j={name:"undiagnosed",inject:["reload"],created:function(){this.get_patients(1,10)},methods:{reloadFun:function(){this.reload()},refresh:function(){this.reloadFun();this.currentPage=1;var e=this.page_size,t=this.inputVal;this.otherDate?(this.get_patients_by_rules(1,e,this.dateValue,t),console.log("otherdate")):(this.get_patients_by_rules(1,e,"",t),console.log("total"))},handleSizeChange:function(e){var t=e;this.page_size=t,this.currentPage=1;var i=this.currentPage,a=this.inputVal;console.log(i,t),this.otherDate?(this.get_patients_by_rules(i,t,this.dateValue,a),console.log("otherdate")):(this.get_patients_by_rules(i,t,"",a),console.log("page_size total"))},handleCurrentChange:function(e){var t=e,i=this.page_size,a=this.inputVal;console.log(t,i),this.otherDate?(this.get_patients_by_rules(t,i,this.dateValue,a),console.log("otherdate")):(this.get_patients_by_rules(t,i,"",a),console.log("pagination total"))},turnBlue:function(e){"isActive1"==e.currentTarget.id&&(console.log("isActive1"),this.isActive1=!0,this.isActive2=!1,this.isActive3=!1,this.isActive4=!1,this.otherDate=!1,this.dateValue="",this.refresh())},tabledataProcess:function(e){for(var t=[],i=[],a=0;a<e.length;a++)if(-1===t.indexOf(e[a].patient_id)){var n=e[a].diagnose.length;null!==e[a].diagnose[n-1].review_time&&(t.push(e[a].patient_id),i.push(e[a]))}return console.log("temp2",i),i},get_patients:function(e,t,i,a){var n=this,r=F.a.getCookie("hospital_id");w.a.get($+"patients/?p="+e+"&page_size="+t+"&hospital_id="+r+"&ordering=-apply_time&transform=1").then(function(e){n.tableData=e.data.results,n.totalNum=e.data.count}).catch(function(e){console.log(e)})},get_patients_by_rules:function(e,t,i,a){var n=this,r=F.a.getCookie("hospital_id");w.a.get($+"patients/?p="+e+"&page_size="+t+"&ordering=-apply_time&apply_time="+i+"&search="+a+"&hospital_id="+r+"&transform=1").then(function(e){console.log("transform",e),n.tableData=e.data.results,n.totalNum=e.data.count,n.tableData=data,n.totalNum=data.length}).catch(function(e){console.log(e)})},selectDate:function(){this.isActive1=!1,this.isActive4=!0,this.otherDate=!0;var e=new Date(this.dateValue),t=e.getFullYear(),i=e.getMonth()+1,a=e.getDate();i>=1&&i<=9&&(i="0"+i),a>=0&&a<=9&&(a="0"+a);var n=t+"-"+i+"-"+a;this.dateValue=n,this.currentPage=1;var r=this.inputVal;console.log(this.dateValue),console.log(r),this.get_patients_by_rules(1,this.page_size,n,r)},searchBtn:function(){console.log("searchBtn"),this.currentPage=1,this.get_patients_by_rules(1,this.page_size,this.dateValue,this.inputVal)},formatSex:function(e){return"0"===e.patient_gender?"男":"1"===e.patient_gender?"女":"未知"},formatStatus:function(e){var t=e.diagnose.length-1;return"unInform"===e.diagnose[t].inform_type?"未通知":"message"===e.diagnose[t].inform_type?"已短信通知":"已电话通知"},formatTime:function(e){var t=e.diagnose.length-1;return e.diagnose[t].apply_time},handleEdit:function(e,t){console.log(e,t);var i=t.diagnose.length;t.review_time=t.diagnose[i-1].review_time,t.review_hospital=t.diagnose[i-1].review_hospital,this.editFormVisible=!0,this.editForm=y()({},t)},editSubmit:function(){var e=this;this.$refs.editForm.validate(function(t){t&&e.$confirm("确认提交吗？","提示",{}).then(function(){e.editLoading=!0;var t=y()({},e.editForm);console.log(t),Object(k.e)(t).then(function(t){e.editLoading=!1,e.$message({message:"提交成功",type:"success"}),e.$refs.editForm.resetFields(),e.editFormVisible=!1,e.refresh()})})})},handleSelectionChange:function(e){this.multipleSelection=e,console.log(e)},showSms:function(e,t){this.dialogVisible=!0,console.log(e,t);var i=t.diagnose.length;t.review_time=t.diagnose[i-1].review_time,t.review_hospital=t.diagnose[i-1].review_hospital,this.editForm=y()({},t)},sendSms:function(){var e=this;this.dialogVisible=!1;var t=y()({},this.editForm);Object(k.j)(t).then(function(t){"1"==t?e.$message({message:"短信发送成功",type:"success"}):e.$message({message:"短信发送失败",type:"error"}),e.editLoading=!1,e.refresh()})},batchSendSms:function(){var e=this;0!=this.multipleSelection.length?this.$confirm("即将批量发送短信, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.dialogVisible=!1;var t=e.multipleSelection;Object(k.j)(t).then(function(t){console.log("res>",t),"1"==t?e.$message({message:"短信发送成功",type:"success"}):e.$message({message:"短信发送失败",type:"error"}),e.editLoading=!1,e.refresh()})}).catch(function(){e.$message({type:"info",message:"已取消"})}):this.$message({message:"请选择患者",type:"error"})}},data:function(){return{tableData:[],multipleSelection:[],dateValue:"",isActive1:!0,isActive2:!1,isActive3:!1,isActive4:!1,currentPage:1,inputVal:"",page_size:10,totalNum:30,otherDate:!1,dialogVisible:!1,pickerOptions:{disabledDate:function(e){return e.getTime()>Date.now()},shortcuts:[{text:"今天",onClick:function(e){e.$emit("pick",new Date)}},{text:"昨天",onClick:function(e){var t=new Date;t.setTime(t.getTime()-864e5),e.$emit("pick",t)}},{text:"一周前",onClick:function(e){var t=new Date;t.setTime(t.getTime()-6048e5),e.$emit("pick",t)}}]},reviewTimeOption:{disabledDate:function(e){return e.getTime()<Date.now()}},editFormVisible:!1,editLoading:!1,editFormRules:{patient_name:[{required:!0,message:"请输入姓名",trigger:"blur"}],patient_tel:[{required:!0,message:"请输入手机号",trigger:"blur"},{validator:function(e,t,i){11!==t.length?i(new Error("手机号为11位")):i()},trigger:"blur"}],review_time:[{required:!0,message:"请输入复查时间",trigger:"blur"}],review_hospital:[{required:!0,message:"请输入复查医院",trigger:"blur"}]},editForm:{patient_id:0,patient_name:"测试",patient_gender:"0",patient_age:0,patient_tel:18888888888,birth:"",address:"",review_time:"",review_hospital:"兴园社区"}}}},A={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"undiagnosed"},[i("el-row",[i("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[i("el-breadcrumb-item",{attrs:{to:{path:"/"}}},[e._v("PACS")]),e._v(" "),i("el-breadcrumb-item",[e._v("转化列表")])],1)],1),e._v(" "),i("el-row",{staticClass:"operationNew"},[i("el-col",{class:{active:e.isActive1},attrs:{span:2}},[i("a",{attrs:{id:"isActive1",href:"javascript:;"},on:{click:e.turnBlue}},[e._v("全部")])]),e._v(" "),i("el-col",{staticClass:"timepicker",class:{active:e.isActive4},attrs:{span:3}},[i("a",{attrs:{id:"isActive4",href:"javascript:;"},on:{click:function(e){}}},[i("el-date-picker",{attrs:{align:"right",type:"date",placeholder:"选择日期","picker-options":e.pickerOptions},on:{change:e.selectDate},model:{value:e.dateValue,callback:function(t){e.dateValue=t},expression:"dateValue"}})],1)]),e._v(" "),i("el-col",{attrs:{span:6}},[e._v(" ")]),e._v(" "),i("el-col",{attrs:{span:4}},[i("el-button",{attrs:{type:"primary"},on:{click:e.batchSendSms}},[e._v("批量发送短信"),i("i",{staticClass:"el-icon-s-comment el-icon--right"})])],1),e._v(" "),i("div",{staticStyle:{"text-align":"center"}},[i("el-col",{attrs:{span:2}},[i("a",{attrs:{href:"javascript:;"},on:{click:e.refresh}},[i("i",{staticClass:"icon iconfont icon-shuaxin1"}),e._v("刷新")])]),e._v(" "),i("el-col",{attrs:{span:5}},[i("el-input",{attrs:{placeholder:"输入患者姓名/手机号/身份证号 可模糊检索"},model:{value:e.inputVal,callback:function(t){e.inputVal=t},expression:"inputVal"}})],1),e._v(" "),i("el-col",{attrs:{span:2}},[i("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.searchBtn}},[e._v("搜索")])],1)],1)],1),e._v(" "),i("el-row",{staticClass:"dataZone"},[[i("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:e.tableData,stripe:""},on:{"selection-change":e.handleSelectionChange}},[i("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),i("el-table-column",{attrs:{prop:"patient_name",label:"姓名"}}),e._v(" "),i("el-table-column",{attrs:{prop:"patient_gender",label:"性别",formatter:e.formatSex}}),e._v(" "),i("el-table-column",{attrs:{prop:"patient_age",label:"年龄"}}),e._v(" "),i("el-table-column",{attrs:{prop:"patient_tel",label:"手机号"}}),e._v(" "),i("el-table-column",{attrs:{prop:"apply_time",label:"录入时间",formatter:e.formatTime}}),e._v(" "),i("el-table-column",{attrs:{prop:"diagnose[diagnose.length - 1].inform_type",label:"状态",formatter:e.formatStatus}}),e._v(" "),i("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-tooltip",{attrs:{content:"发送短信",placement:"left"}},[i("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-chat-dot-round",circle:""},on:{click:function(i){return e.showSms(t.$index,t.row)}}})],1),e._v(" "),i("el-tooltip",{attrs:{content:"编辑短信",placement:"right"}},[i("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-edit",circle:""},on:{click:function(i){return e.handleEdit(t.$index,t.row)}}})],1)]}}])})],1)]],2),e._v(" "),i("el-row",{staticClass:"pagination"},[i("el-pagination",{attrs:{"current-page":e.currentPage,"page-sizes":[5,10],"page-size":e.page_size,"pager-count":7,layout:"total, sizes, prev, pager, next, jumper",total:e.totalNum},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange,"update:currentPage":function(t){e.currentPage=t},"update:current-page":function(t){e.currentPage=t}}})],1),e._v(" "),i("el-dialog",{attrs:{title:"编辑短信内容",visible:e.editFormVisible,"close-on-click-modal":!1},on:{"update:visible":function(t){e.editFormVisible=t}},model:{value:e.editFormVisible,callback:function(t){e.editFormVisible=t},expression:"editFormVisible"}},[i("el-form",{ref:"editForm",attrs:{model:e.editForm,"label-width":"80px",rules:e.editFormRules}},[i("el-form-item",{staticStyle:{width:"25%"},attrs:{label:"姓名",prop:"patient_name"}},[i("el-input",{attrs:{"auto-complete":"off",readonly:""},model:{value:e.editForm.patient_name,callback:function(t){e.$set(e.editForm,"patient_name",t)},expression:"editForm.patient_name"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"手机号",prop:"patient_tel"}},[i("el-input",{staticStyle:{width:"25%"},attrs:{type:"text",placeholder:"手机号",oninput:"value=value.replace(/[^\\d]/g,'')",maxlength:"11","show-word-limit":""},model:{value:e.editForm.patient_tel,callback:function(t){e.$set(e.editForm,"patient_tel",t)},expression:"editForm.patient_tel"}})],1),e._v(" "),i("el-form-item",{staticStyle:{width:"25%"},attrs:{label:"复查时间",prop:"review_time"}},[i("el-date-picker",{attrs:{align:"right",type:"date",placeholder:"选择日期","value-format":"yyyy-MM-dd","picker-options":e.reviewTimeOption},model:{value:e.editForm.review_time,callback:function(t){e.$set(e.editForm,"review_time",t)},expression:"editForm.review_time"}})],1),e._v(" "),i("el-form-item",{staticStyle:{width:"25%"},attrs:{label:"复查医院",prop:"review_hospital"}},[i("el-input",{attrs:{type:"text"},model:{value:e.editForm.review_hospital,callback:function(t){e.$set(e.editForm,"review_hospital",t)},expression:"editForm.review_hospital"}})],1)],1),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{nativeOn:{click:function(t){e.editFormVisible=!1}}},[e._v("取消")]),e._v(" "),i("el-button",{attrs:{type:"primary",loading:e.editLoading},nativeOn:{click:function(t){return e.editSubmit(t)}}},[e._v("提交")])],1)],1),e._v(" "),i("el-dialog",{attrs:{title:"提示",visible:e.dialogVisible,width:"30%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[i("span",[e._v("您将要发送如下短信:"),i("br"),e._v("尊敬的"+e._s(e.editForm.patient_name)+"\n        "),"1"===e.editForm.patient_gender?i("span",[e._v("女士")]):i("span",[e._v("先生")]),e._v(",\n        请于"+e._s(e.editForm.review_time)+"前,前往"+e._s(e.editForm.review_hospital)+"进行眼底情况复查")]),e._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),e._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:e.sendSms}},[e._v("确 定")])],1)])],1)},staticRenderFns:[]};var L=i("VU/8")(j,A,!1,function(e){i("vBAv")},"data-v-5aa55a5d",null).exports,z=i("XLwt"),I=i.n(z),P={data:function(){return{chartColumn:null,chartBar:null,chartLine:null,chartPie:null}},methods:{drawColumnChart:function(){this.chartColumn=I.a.init(document.getElementById("chartColumn")),this.chartColumn.setOption({title:{text:"Column Chart"},tooltip:{},xAxis:{data:["渗出","豹纹眼底","青光眼","白内障","糖网","黄斑病变"]},yAxis:{},series:[{name:"销量",type:"bar",data:[5,20,36,10,10,20]}]})},drawBarChart:function(){this.chartBar=I.a.init(document.getElementById("chartBar")),this.chartBar.setOption({title:{text:"Bar Chart",subtext:"数据来自奥比斯科技"},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},legend:{data:["2018年","2019年"]},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"value",boundaryGap:[0,.01]},yAxis:{type:"category",data:["天乐","兴园","荷叶地","普瑞","爱尔","病患转化数(万)"]},series:[{name:"2018年",type:"bar",data:[18203,23489,29034,104970,131744,630230]},{name:"2019年",type:"bar",data:[19325,23438,31e3,121594,134141,681807]}]})},drawLineChart:function(){this.chartLine=I.a.init(document.getElementById("chartLine")),this.chartLine.setOption({title:{text:"Line Chart"},tooltip:{trigger:"axis"},legend:{data:["短信营销","电话营销","邮件营销"]},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:["周一","周二","周三","周四","周五","周六","周日"]},yAxis:{type:"value"},series:[{name:"短信营销",type:"line",stack:"总量",data:[120,132,101,134,90,230,210]},{name:"电话营销",type:"line",stack:"总量",data:[220,182,191,234,290,330,310]},{name:"邮件营销",type:"line",stack:"总量",data:[820,932,901,934,1290,1330,1320]}]})},drawPieChart:function(){this.chartPie=I.a.init(document.getElementById("chartPie")),this.chartPie.setOption({title:{text:"Pie Chart",subtext:"数据来自奥比斯科技",x:"center"},tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},legend:{orient:"vertical",left:"left",data:["直接访问","邮件营销","联盟广告","视频广告","搜索引擎"]},series:[{name:"访问来源",type:"pie",radius:"55%",center:["50%","60%"],data:[{value:335,name:"直接访问"},{value:310,name:"邮件营销"},{value:234,name:"联盟广告"},{value:135,name:"视频广告"},{value:1548,name:"搜索引擎"}],itemStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]})},drawCharts:function(){this.drawColumnChart(),this.drawBarChart(),this.drawLineChart(),this.drawPieChart()}},mounted:function(){this.drawCharts()},updated:function(){this.drawCharts()}},R={render:function(){var e=this.$createElement,t=this._self._c||e;return t("section",{staticClass:"chart-container"},[t("el-row",[t("el-col",{attrs:{span:12}},[t("div",{staticStyle:{width:"100%",height:"400px"},attrs:{id:"chartColumn"}})]),this._v(" "),t("el-col",{attrs:{span:12}},[t("div",{staticStyle:{width:"100%",height:"400px"},attrs:{id:"chartBar"}})]),this._v(" "),t("el-col",{attrs:{span:12}},[t("div",{staticStyle:{width:"100%",height:"400px"},attrs:{id:"chartLine"}})]),this._v(" "),t("el-col",{attrs:{span:12}},[t("div",{staticStyle:{width:"100%",height:"400px"},attrs:{id:"chartPie"}})])],1)],1)},staticRenderFns:[]};var E=i("VU/8")(P,R,!1,function(e){i("T5vU")},"data-v-a32ce296",null).exports,N=i("fZjL"),B=i.n(N),O=S.a.url,H={data:function(){return{jwsDisplayInfo:"无",warning:"",warningShow:!1,hospital_name:"",patient_info:{},restaurants:[],AIdata:{},state:"",timeout:null,suggestions:["定时随访","上级医院就诊","正常,无需随访"],diseases:["高血压视网膜病变","糖尿病视网膜病变","豹纹状眼底","渗出","青光眼","年龄相关性视网膜病变"],fits:["fill"],right_src:"https://www.orbisbiotech.cn/media/xingyuan/2019080410421718855145058_Right_1_origin.png",left_src:"https://www.orbisbiotech.cn/media/xingyuan/2019080410421718855145058_Left_2_origin.png",right_srcList:[],left_srcList:[],dynamicTagsR:[],dynamicTagsL:[],dynamicTagsA:[],diaStrR:"",diaStrL:"",diaStrA:"",finishSeen:!1,beforeSeen:!0,inputVisibleR:!1,inputVisibleL:!1,inputVisibleA:!1,leftEye:!1,rightEye:!1,advice:!1,inputValueR:"",inputValueL:"",inputValueA:"",seen:!0,seen2:!1,eyeSeen:!1,diaSeen:!0,activeColor1:"azure",activeColor2:"azure",dialogVisible:!1,uplevelVisible:!1,uplevelHospital:"",fullscreenLoading:!1,centerDialogVisible:!1,pickerOptions:{disabledDate:function(e){return e.getTime()<Date.now()},shortcuts:[{text:"今天",onClick:function(e){e.$emit("pick",new Date)}},{text:"明天",onClick:function(e){var t=new Date;t.setTime(t.getTime()+864e5),e.$emit("pick",t)}},{text:"一周后",onClick:function(e){var t=new Date;t.setTime(t.getTime()+6048e5),e.$emit("pick",t)}}]},value1:"",value2:"",strengthen:!1}},methods:{handleCloseR:function(e){this.dynamicTagsR.splice(this.dynamicTagsR.indexOf(e),1)},showInputR:function(){var e=this;this.activeColor2="lightblue",this.inputVisibleR=!0,this.rightEye=!0,this.leftEye=!1,this.$nextTick(function(t){e.$refs.saveTagInputR.$refs.input.focus()})},handleInputConfirmR:function(){this.activeColor2="azure";var e=this.inputValueR;e&&this.dynamicTagsR.push(e),this.inputVisibleR=!1,this.inputValueR=""},handleCloseL:function(e){this.dynamicTagsL.splice(this.dynamicTagsL.indexOf(e),1)},showInputL:function(){var e=this;this.activeColor2="lightblue",this.inputVisibleL=!0,this.rightEye=!1,this.leftEye=!0,this.$nextTick(function(t){e.$refs.saveTagInputL.$refs.input.focus()})},handleInputConfirmL:function(){this.activeColor2="azure";var e=this.inputValueL;e&&this.dynamicTagsL.push(e),this.inputVisibleL=!1,this.inputValueL=""},handleCloseA:function(e){this.dynamicTagsA.splice(this.dynamicTagsA.indexOf(e),1),this.seen=!0,this.seen2=!1,this.value2=""},showInputA:function(){var e=this;this.leftEye=!1,this.rightEye=!1,this.activeColor1="lightblue",this.inputVisibleA=!0,this.advice=!0,this.$nextTick(function(t){e.$refs.saveTagInputA.$refs.input.focus()})},handleInputConfirmA:function(){this.activeColor1="azure";var e=this.inputValueA,t=this.dynamicTagsA;e&&this.dynamicTagsA.push(e),0!==t.length&&(this.seen=!1),this.inputVisibleA=!1,this.inputValueA=""},addDiagnose:function(e){if(this.leftEye){this.dynamicTagsL.push(e);var t=this.duplicateRemove(this.dynamicTagsL);this.dynamicTagsL=t,this.handleInputConfirmL()}else if(this.rightEye){this.dynamicTagsR.push(e);var i=this.duplicateRemove(this.dynamicTagsR);this.dynamicTagsR=i,this.handleInputConfirmR()}},addAdvice:function(e){var t=this.dynamicTagsA;if(this.advice){if(0!==t.length)return;this.dynamicTagsA.push(e),this.handleInputConfirmA(),"定时随访"===e&&(this.dialogVisible=!0),"上级医院就诊"===e&&(this.uplevelVisible=!1)}},formatSex:function(e){return"0"===e.patient_gender?"男":"1"===e.patient_gender?"女":"未知"},finishDiagnose:function(){var e=this.dynamicTagsR.toString(),t=this.dynamicTagsL.toString(),i=this.dynamicTagsA[0].toString();if(e.length>40||t.length>40||i.length>40)return this.$alert("建议和左右眼诊断内容每条不可超过40个字符","提示",{confirmButtonText:"确定"}),!1;this.diaStrR=e,this.diaStrL=t,this.submitDiagnose(),this.eyeSeen=!0,this.diaSeen=!1,this.finishSeen=!0,this.beforeSeen=!1},openFullScreen:function(){var e=this;if(0!==this.dynamicTagsA.length){var t=this.$loading({lock:!0,text:"Loading",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});setTimeout(function(){t.close(),e.finishDiagnose()},500)}else this.open()},backToUndiagnosed:function(){var e=this;if(0!==this.dynamicTagsA.length){var t={};t.page_size=this.patient_info.page_size,t.currentPage=this.patient_info.currentPage;var i=this.finishDiagnose();if(console.log("backToUndiagnosed",i),!1!==i){var a=this.$loading({lock:!0,text:"Loading",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});setTimeout(function(){a.close(),e.$store.commit("backToUndiagnosed")},1e3)}}else this.open()},onlyBack:function(){var e=this,t={};t.page_size=this.patient_info.page_size,t.currentPage=this.patient_info.currentPage;var i=this.$loading({lock:!0,text:"Loading",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});setTimeout(function(){i.close(),e.$store.commit("backToUndiagnosed",t)},1e3)},getConclusion:function(){var e=this;w.a.get(O+"/conclusion/?&ordering=-times").then(function(t){console.log(t.data);for(var i=t.data,a=[],n=0;n<i.length;n++)a.push(i[n].conclusion);e.diseases=a.slice(0,9)}).catch(function(e){console.log(e)})},getDiagnoseResult:function(){var e={},t={},i={};if(e.patient_id=this.patient_info.patient_id,e.diagnose_record=this.patient_info.diagnose_record,e.apply_time=this.patient_info.apply_time,e.patient_name=this.patient_info.patient_name,e.patient_gender=this.patient_info.patient_gender,e.patient_age=this.patient_info.patient_age,e.left_diagnose=this.diaStrL,e.right_diagnose=this.diaStrR,e.diagnose_advice=this.dynamicTagsA[0],e.jwsInfo=this.jwsDisplayInfo,t.username=F.a.getCookie("name"),t.right_origin_src=this.right_src.split("media")[this.right_src.split("media").length-1],t.left_origin_src=this.left_src.split("media")[this.left_src.split("media").length-1],-1===t.right_origin_src.search("noimg")){var a=t.right_origin_src.lastIndexOf("."),n=t.right_origin_src.substr(a);console.log("新式眼底格式2",n),t.right_AI_src=t.right_origin_src.replace(n,"_AI"+n)}else t.right_AI_src=this.right_src.split("media")[this.right_src.split("media").length-1];if(-1===t.left_origin_src.search("noimg")){var r=t.left_origin_src.lastIndexOf("."),o=t.left_origin_src.substr(r);console.log("新式眼底格式1",o),t.left_AI_src=t.left_origin_src.replace(o,"_AI"+o)}else t.left_AI_src=this.left_src.split("media")[this.left_src.split("media").length-1];return this.value2&&(e.review_time=this.value2,e.transform="1"),this.uplevelHospital&&(e.review_hospital=this.uplevelHospital,e.transform="1"),t.oozed_amount=this.AIdata.oozed_amount,t.bleeding_amount=this.AIdata.bleeding_amount,t.oozed_area=this.AIdata.oozed_area,t.bleeding_area=this.AIdata.bleeding_area,t.max_oozed_area=this.AIdata.max_oozed_area,t.max_bleeding_area=this.AIdata.max_bleeding_area,t.other_advice="",i.basic_data=e,i.other_data=t,i},submitDiagnose:function(){var e=this,t=this.getDiagnoseResult();console.log("start submit diagnose result",t),w.a.post(O+"operation/submit/",t).then(function(t){console.log("res=>",t),0===t.data&&e.$alert("阅片失败","提示",{confirmButtonText:"确定"})}).catch(function(t){console.log(t),e.$alert("阅片错误","提示",{confirmButtonText:"确定"})})},getHospitalName:function(){var e=this,t=this.patient_info.hospital_id,i={};i.hospital_id=t,w.a.post(O+"operation/get_hospital_name/",i).then(function(t){console.log("res=>",t),0===t.data?e.hospital_name="":e.hospital_name=t.data}).catch(function(t){console.log(t),e.$alert("阅片错误","提示",{confirmButtonText:"确定"})})},duplicateRemove:function(e){for(var t=[],i=0;i<e.length;i++)-1===t.indexOf(e[i])&&t.push(e[i]);return console.log(t),t},createReport:function(){var e=this,t=this.$loading({lock:!0,text:"Loading",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),i=this.getDiagnoseResult();w.a.post(O+"operation/createPdf/",i).then(function(a){if(t.close(),console.log("res=>",a.data),a.data.length>1){var n=Math.random().toString(36).substr(2),r=window.open("",n,"");r.document.title="pdf";var o=i.basic_data.patient_name,s=i.basic_data.patient_id,l="/media/patient_pdf/"+a.data+"/"+o+"_"+s+".pdf";r.location=l}else e.$alert("诊断报告生成失败","提示",{confirmButtonText:"确定"})}).catch(function(i){t.close(),console.log(i),e.$alert("请允许弹窗","提示",{confirmButtonText:"确定"})})},finishAndCreatePdf:function(){var e=this;if(0!==this.dynamicTagsA.length)try{console.log("start submit");var t=this.$loading({lock:!0,text:"Loading",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});setTimeout(function(){t.close(),!1!==e.finishDiagnose()&&e.createReport()},500)}catch(e){console.log(e)}else this.open()},cancelSelectDate:function(){this.dialogVisible=!1,this.seen2=!1,this.value2=""},confirmSelectDate:function(){this.dialogVisible=!1,this.seen2=!0,this.value2||(this.seen2=!1,this.value2="")},cancelInputHospital:function(){this.uplevelVisible=!1,this.uplevelHospital=""},confirmInputHospital:function(){this.uplevelVisible=!1},open:function(){this.$alert("请添加建议","提示",{confirmButtonText:"确定"})},loadAll:function(){var e=this;w.a.get(O+"/conclusion/?&ordering=-times").then(function(t){for(var i=t.data,a=[],n=function(e){delete i[e].id,delete i[e].times;var t={conclusion:"value"},n=B()(i[e]).reduce(function(a,n){return a[t[n]||n]=i[e][n],a},{});a.push(n)},r=0;r<i.length;r++)n(r);e.restaurants=a}).catch(function(t){console.log(t),e.restaurants=[]})},querySearchAsync:function(e,t){var i=this.restaurants,a=e?i.filter(this.createStateFilter(e)):i;clearTimeout(this.timeout),this.timeout=setTimeout(function(){t(a)},300*Math.random())},createStateFilter:function(e){return function(t){return 0===t.value.toLowerCase().indexOf(e.toLowerCase())}},handleSelect:function(e){console.log(e.value),this.addDiagnose(e.value)},AiDiagnose:function(e){console.log("病理近视",e);e.left_rm,e.left_pm,e.right_rm,e.right_pm;var t=e.left_oozed_amount,i=e.right_oozed_amount,a=e.left_oozed_area,n=e.right_oozed_area,r=e.left_bleeding_amount,o=e.right_bleeding_amount,s=e.left_bleeding_area,l=e.right_bleeding_area,c=e.left_max_bleeding_area,d=e.right_max_bleeding_area,u=e.left_max_oozed_area,p=e.right_max_oozed_area,g=e.left_prob_dr,m=e.right_prob_dr,h=e.left_warning,_=e.right_warning;this.AIdata.iqa_score_left=e.left_iqa_score<60?"不佳":e.left_iqa_score>=75?"良好":"一般",this.AIdata.iqa_score_right=e.right_iqa_score<60?"不佳":e.right_iqa_score>=75?"良好":"一般",this.AIdata.oozed_area=(10*a+10*n)/10,this.AIdata.oozed_amount=t+i,this.AIdata.max_oozed_area=(10*u+10*p)/10,this.AIdata.bleeding_area=(10*s+10*l)/10,this.AIdata.bleeding_amount=r+o,this.AIdata.max_bleeding_area=(10*c+10*d)/10,1===h&&1===_?(this.warningShow=!0,this.warning="因左右眼照片质量不达标，故左右眼均不进行AI诊断"):1===h&&0===_?(this.warningShow=!0,this.warning="因左眼照片质量不达标，故左眼不进行AI诊断"):0===h&&1===_&&(this.warningShow=!0,this.warning="因右眼照片质量不达标，故右眼不进行AI诊断"),1===g&&this.dynamicTagsL.push("疑似糖尿病视网膜病变"),1===m&&this.dynamicTagsR.push("疑似糖尿病视网膜病变"),1!==m&&1!==g||this.dynamicTagsA.push("上级医院就诊"),this.handleInputConfirmA()},picture_strengthen:function(){var e=this,t=this.strengthen,i=this.right_src.split("media")[this.right_src.split("media").length-1],a=this.left_src.split("media")[this.left_src.split("media").length-1],n={};n.left_src=a,n.right_src=i,t?w.a.post(O+"operation/strengthen/",n).then(function(t){if(console.log("res=>",t),0===t.data)e.$alert("一键增强失败","提示",{confirmButtonText:"确定"});else{if(-1===a.search("noimg")){var n=e.left_src.lastIndexOf("."),r=e.left_src.substr(n);e.left_src=e.left_src.replace(r,"_strengthen"+r),e.left_srcList[0]=e.left_src}if(-1===i.search("noimg")){var o=e.right_src.lastIndexOf("."),s=e.right_src.substr(o);e.right_src=e.right_src.replace(s,"_strengthen"+s),e.right_srcList[0]=e.right_src}}}).catch(function(t){console.log(t),e.$alert("一键增强失败","提示",{confirmButtonText:"确定"})}):(-1===i.search("noimg")&&(this.right_src=this.right_src.replace("_strengthen",""),this.right_srcList[0]=this.right_src),-1===a.search("noimg")&&(this.left_src=this.left_src.replace("_strengthen",""),this.left_srcList[0]=this.left_src))},display_history_diseases:function(){var e=this.patient_info.historyDisease;if(0===e.length)this.jwsDisplayInfo="无";else{this.jwsDisplayInfo="有",console.log("既往史细节",e[0]);var t="";if(1===e[0].DM_year&&(t="糖尿病 "),1===e[0].HPL_year&&(t+="高血脂 "),1===e[0].HTN_year&&(t+="高血压 "),e[0].left_diopter&&("0"===e[0].left_diopter?t+="左眼:正视 ":"1"===e[0].left_diopter?t+="左眼:低度近视(75~300) ":"2"===e[0].left_diopter?t+="左眼:中度近视(300~600) ":"3"===e[0].left_diopter?t+="左眼:高度近视(>600) ":"4"===e[0].left_diopter&&(t+="左眼:远视 ")),e[0].right_diopter&&("0"===e[0].right_diopter?t+="右眼:正视 ":"1"===e[0].right_diopter?t+="右眼:低度近视(75~300) ":"2"===e[0].right_diopter?t+="右眼:中度近视(300~600) ":"3"===e[0].right_diopter?t+="右眼:高度近视(>600) ":"4"===e[0].right_diopter&&(t+="右眼:远视 ")),e[0].pregnant_weeks)t=t+"妊娠"+e[0].pregnant_weeks+"周 ";if(e[0].other)t=t+"其他:"+e[0].other+" ";this.jwsDisplayInfo=t}}},mounted:function(){this.loadAll(),document.getElementById("aside_id").style.height=window.innerHeight-46+"px",this.patient_info=this.$store.state.patient_info;var e=this.patient_info.diagnose.length-1;this.AIdata=this.patient_info.diagnose[e],this.AiDiagnose(this.patient_info.diagnose[e]),this.display_history_diseases();try{var t=this.patient_info.picture;console.log("所有照片信息",t);var i=t.length-1,a=[],n=[],r=t[i].own_to;console.log("latest",r);for(var o=0;o<t.length;o++)if(console.log(t[o].pic_name),t[o].own_to===r)if(-1===t[o].pic_name.search("infrared"))if(-1!==t[o].pic_name.search("Left")){var s=O+"media/"+t[o].hospital+"/"+t[o].pic_name;a.push(s)}else{var l=O+"media/"+t[o].hospital+"/"+t[o].pic_name;n.push(l)}else console.log("i find infrared and filter it");if(a=a.reverse(),0===(n=n.reverse()).length){console.log("左眼没有照片");var c=[];c[0]=O+"media/noimg.jpg",console.log(c),this.right_src=c[0],this.right_srcList=[]}else this.right_src=n[0],this.right_srcList=n;if(0===a.length){console.log("右眼没有照片");var d=[];d[0]=O+"media/noimg.jpg",console.log(d),this.left_src=d[0],this.left_srcList=[]}else this.left_src=a[0],this.left_srcList=a}catch(e){console.log(e)}this.getConclusion(),this.getHospitalName()}},M={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-container",[i("el-aside",{staticClass:"aside",attrs:{id:"aside_id"}},[i("el-row",{staticStyle:{"text-align":"left",height:"40px","line-height":"40px"},style:{backgroundColor:e.activeColor2}},[i("i",{staticClass:"icon iconfont icon-icon-test"}),e._v("单击可将词条插入诊断内容\n  ")]),e._v(" "),i("el-row",{staticStyle:{"margin-top":"20px"}},[i("el-autocomplete",{attrs:{"fetch-suggestions":e.querySearchAsync,placeholder:"可模糊搜索疑似病种","prefix-icon":"el-icon-search"},on:{select:e.handleSelect},model:{value:e.state,callback:function(t){e.state=t},expression:"state"}})],1),e._v(" "),i("el-row",{staticStyle:{height:"40px","line-height":"40px","text-align":"left","margin-top":"20px","background-color":"azure"},style:{backgroundColor:e.activeColor2}},[e._v("\n    病种栏\n  ")]),e._v(" "),e._l(e.diseases,function(t){return i("el-row",{key:t.id,staticClass:"diseases_section"},[i("el-col",{attrs:{span:3}},[e._v(" ")]),e._v(" "),i("el-col",{attrs:{span:18}},[i("a",{attrs:{href:"javascript:;"},on:{click:function(i){return e.addDiagnose(t)}}},[i("div",{staticStyle:{border:"1px solid lightgrey",height:"30px","line-height":"30px","border-radius":"20px"}},[e._v(e._s(t))])])]),e._v(" "),i("el-col",{attrs:{span:3}},[e._v(" ")])],1)}),e._v(" "),i("el-row",{staticStyle:{height:"40px","line-height":"40px","text-align":"left","margin-top":"20px"},style:{backgroundColor:e.activeColor1}},[e._v("\n      建议栏\n    ")]),e._v(" "),e._l(e.suggestions,function(t){return i("el-row",{key:t.id,staticClass:"suggestion_section"},[i("el-col",{attrs:{span:3}},[e._v(" ")]),e._v(" "),i("el-col",{attrs:{span:18}},[i("a",{attrs:{href:"javascript:;"},on:{click:function(i){return e.addAdvice(t)}}},[i("div",{staticStyle:{border:"1px solid lightgrey",height:"30px","line-height":"30px","border-radius":"20px"}},[e._v(e._s(t))])])]),e._v(" "),i("el-col",{attrs:{span:3}},[e._v(" ")])],1)})],2),e._v(" "),i("el-main",{staticClass:"main"},[i("el-row",[i("span",[e._v(e._s(e.hospital_name))])]),e._v(" "),i("el-row",{staticStyle:{"margin-top":"20px",height:"40px","line-height":"40px"}},[i("el-col",{attrs:{span:4}},[e._v(" ")]),e._v(" "),i("el-col",{staticStyle:{"border-top":"lightgrey 1px solid","border-bottom":"lightgrey 1px solid","text-align":"left"},attrs:{span:16}},[i("el-row",[i("el-col",{attrs:{xl:6,lg:5,md:5,sm:5}},[e._v("姓名:"),i("span",[e._v(e._s(e.patient_info.patient_name))])]),e._v(" "),i("el-col",{attrs:{xl:5,lg:5,md:5,sm:4}},[e._v("性别:"),"1"===e.patient_info.patient_gender?i("span",[e._v("女")]):i("span",[e._v("男")])]),e._v(" "),i("el-col",{attrs:{xl:5,lg:5,md:5,sm:4}},[e._v("年龄:"),i("span",[e._v(e._s(e.patient_info.patient_age))])]),e._v(" "),i("el-col",{attrs:{xl:8,lg:9,md:9,sm:11}},[e._v("录入时间:"),i("span",{attrs:{id:"apply_time"}},[e._v(e._s(e.patient_info.apply_time))])])],1)],1),e._v(" "),i("el-col",{staticStyle:{border:"1px solid white"},attrs:{span:4}},[e._v(" ")])],1),e._v(" "),i("el-row",{staticStyle:{"margin-top":"20px"}},[i("el-col",{attrs:{span:4}},[e._v(" ")]),e._v(" "),i("el-col",{attrs:{span:16}},[i("el-row",{staticStyle:{"text-align":"left","font-weight":"bold"}},[i("el-col",{attrs:{span:11}},[e._v("OD(图像质量:"+e._s(e.AIdata.iqa_score_right)+")")]),e._v(" "),i("el-col",{attrs:{span:2}},[e._v(" ")]),e._v(" "),i("el-col",{attrs:{span:11}},[e._v("OS(图像质量:"+e._s(e.AIdata.iqa_score_left)+")")])],1)],1),e._v(" "),i("el-col",{attrs:{span:4}},[e._v(" ")])],1),e._v(" "),i("el-row",{staticStyle:{"margin-top":"20px"}},[i("el-col",{attrs:{span:4}},[e._v(" ")]),e._v(" "),i("el-col",{attrs:{span:16}},[i("el-row",{staticStyle:{"text-align":"left","font-weight":"bold"}},[i("el-col",{attrs:{span:11}},[i("div",{staticClass:"demo-image__preview"},[i("el-image",{staticStyle:{width:"100%",height:"auto"},attrs:{lazy:"",src:e.right_src,"preview-src-list":e.right_srcList}})],1)]),e._v(" "),i("el-col",{attrs:{span:2}},[e._v(" ")]),e._v(" "),i("el-col",{attrs:{span:11}},[i("div",{staticClass:"demo-image__preview"},[i("el-image",{staticStyle:{width:"100%",height:"auto"},attrs:{lazy:"",src:e.left_src,"preview-src-list":e.left_srcList}})],1)])],1)],1),e._v(" "),i("el-col",{attrs:{span:4}},[e._v(" ")])],1),e._v(" "),i("el-row",{staticStyle:{"text-align":"left","margin-top":"20px"}},[i("el-col",{attrs:{span:4}},[e._v(" ")]),e._v(" "),i("el-col",{attrs:{span:16}},[i("span",[e._v("智能图像处理:")])]),e._v(" "),i("el-col",{attrs:{span:4}},[e._v(" ")])],1),e._v(" "),i("el-row",{staticStyle:{"text-align":"left","margin-top":"20px"}},[i("el-col",{attrs:{span:4}},[e._v(" ")]),e._v(" "),i("el-col",{attrs:{span:16}},[i("el-switch",{attrs:{"active-text":"增强","inactive-text":"重置"},on:{change:e.picture_strengthen},model:{value:e.strengthen,callback:function(t){e.strengthen=t},expression:"strengthen"}})],1),e._v(" "),i("el-col",{attrs:{span:4}},[e._v(" ")])],1),e._v(" "),i("el-row",{staticStyle:{"text-align":"left","margin-top":"20px"}},[i("el-col",{attrs:{span:4}},[e._v(" ")]),e._v(" "),i("el-col",{attrs:{span:16}},[i("span",[e._v("既往史:")]),e._v("   \n        "),i("i",{staticClass:"el-icon-warning",staticStyle:{color:"goldenrod","font-size":"small"}},[e._v(" "+e._s(e.jwsDisplayInfo))])]),e._v(" "),i("el-col",{attrs:{span:4}},[e._v(" ")])],1),e._v(" "),i("el-row",{staticStyle:{"text-align":"left","margin-top":"20px"}},[i("el-col",{attrs:{span:4}},[e._v(" ")]),e._v(" "),i("el-col",{attrs:{span:16}},[i("span",[e._v("诊断:")]),e._v("   \n        "),e.warningShow?i("i",{staticClass:"el-icon-warning",staticStyle:{color:"goldenrod","font-size":"small"}},[e._v(" "+e._s(e.warning))]):e._e()]),e._v(" "),i("el-col",{attrs:{span:4}},[e._v(" ")])],1),e._v(" "),e.diaSeen?i("el-row",{staticStyle:{"text-align":"left","margin-top":"10px"}},[i("el-col",{attrs:{span:4}},[e._v(" ")]),e._v(" "),i("el-col",{attrs:{span:16}},[e._v("右眼:\n        "),e._l(e.dynamicTagsR,function(t){return i("el-tag",{key:t,attrs:{closable:"","disable-transitions":!1,type:"info",effect:"plain"},on:{close:function(i){return e.handleCloseR(t)}}},[e._v("\n          "+e._s(t)+"\n        ")])}),e._v(" "),e.inputVisibleR?i("el-input",{ref:"saveTagInputR",staticClass:"input-new-tag",attrs:{size:"small"},on:{blur:e.handleInputConfirmR},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleInputConfirmR(t)}},model:{value:e.inputValueR,callback:function(t){e.inputValueR=t},expression:"inputValueR"}}):i("el-tooltip",{attrs:{placement:"right"}},[i("div",{attrs:{slot:"content"},slot:"content"},[e._v("点击后可手动输入病种"),i("br"),e._v("点击后也可从左侧病种栏选择病种")]),e._v(" "),i("el-button",{staticClass:"button-new-tag",attrs:{size:"small"},on:{click:e.showInputR}},[e._v("+ 添加诊断")])],1)],2),e._v(" "),i("el-col",{attrs:{span:4}},[e._v(" ")])],1):e._e(),e._v(" "),e.diaSeen?i("el-row",{staticStyle:{"text-align":"left","margin-top":"10px"}},[i("el-col",{attrs:{span:4}},[e._v(" ")]),e._v(" "),i("el-col",{attrs:{span:16}},[e._v("左眼:\n        "),e._l(e.dynamicTagsL,function(t){return i("el-tag",{key:t,attrs:{closable:"","disable-transitions":!1,effect:"plain",type:"info"},on:{close:function(i){return e.handleCloseL(t)}}},[e._v("\n          "+e._s(t)+"\n        ")])}),e._v(" "),e.inputVisibleL?i("el-input",{ref:"saveTagInputL",staticClass:"input-new-tag",attrs:{size:"small"},on:{blur:e.handleInputConfirmL},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleInputConfirmL(t)}},model:{value:e.inputValueL,callback:function(t){e.inputValueL=t},expression:"inputValueL"}}):i("el-tooltip",{attrs:{placement:"right"}},[i("div",{attrs:{slot:"content"},slot:"content"},[e._v("点击后可手动输入病种"),i("br"),e._v("点击后也可从左侧病种栏选择病种")]),e._v(" "),i("el-button",{staticClass:"button-new-tag",attrs:{size:"small"},on:{click:e.showInputL}},[e._v("+ 添加诊断")])],1)],2),e._v(" "),i("el-col",{attrs:{span:4}},[e._v(" ")])],1):e._e(),e._v(" "),e.eyeSeen?i("el-row",{staticStyle:{"text-align":"left","margin-top":"10px"}},[i("el-col",{attrs:{span:4}},[e._v(" ")]),e._v(" "),i("el-col",{attrs:{span:16}},[e._v("右眼:"+e._s(e.diaStrR))]),e._v(" "),i("el-col",{attrs:{span:4}},[e._v(" ")])],1):e._e(),e._v(" "),e.eyeSeen?i("el-row",{staticStyle:{"text-align":"left","margin-top":"10px"}},[i("el-col",{attrs:{span:4}},[e._v(" ")]),e._v(" "),i("el-col",{attrs:{span:16}},[e._v("左眼:"+e._s(e.diaStrL))]),e._v(" "),i("el-col",{attrs:{span:4}},[e._v(" ")])],1):e._e(),e._v(" "),e.diaSeen?i("el-row",{staticStyle:{"text-align":"left","margin-top":"20px"}},[i("el-col",{attrs:{span:4}},[e._v(" ")]),e._v(" "),i("el-col",{attrs:{span:16}},[i("span",[e._v("建议:\n       "),e._l(e.dynamicTagsA,function(t){return i("el-tag",{key:t,attrs:{closable:"","disable-transitions":!1,type:"info",effect:"plain"},on:{close:function(i){return e.handleCloseA(t)}}},[e._v("\n          "+e._s(t)+"\n        ")])}),e._v(" "),e.inputVisibleA?i("el-input",{ref:"saveTagInputA",staticClass:"input-new-tag",attrs:{size:"small"},on:{blur:e.handleInputConfirmA},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleInputConfirmA(t)}},model:{value:e.inputValueA,callback:function(t){e.inputValueA=t},expression:"inputValueA"}}):e._e(),e._v(" "),i("el-tooltip",{attrs:{placement:"right"}},[i("div",{attrs:{slot:"content"},slot:"content"},[e._v("点击后可手动输入诊疗建议"),i("br"),e._v("点击后也可从左侧建议栏选择建议")]),e._v(" "),e.seen?i("el-button",{staticClass:"button-new-tag",attrs:{size:"small"},on:{click:e.showInputA}},[e._v("+ 添加建议")]):e._e()],1),e._v("\n           "),e.seen2?i("span",[e._v("日期:"+e._s(e.value2))]):e._e()],2)]),e._v(" "),i("el-col",{attrs:{span:4}},[e._v(" ")])],1):e._e(),e._v(" "),e.eyeSeen?i("el-row",{staticStyle:{"text-align":"left","margin-top":"20px"}},[i("el-col",{attrs:{span:4}},[e._v(" ")]),e._v(" "),i("el-col",{attrs:{span:16}},[i("span",[e._v("建议:"+e._s(e.dynamicTagsA[0])+"\n\n           "),e.seen2?i("span",[e._v("日期:")]):e._e(),e._v(e._s(e.value2)+"\n      ")])]),e._v(" "),i("el-col",{attrs:{span:4}},[e._v(" ")])],1):e._e(),e._v(" "),e.beforeSeen?i("el-row",{staticStyle:{"margin-top":"20px",height:"40px","line-height":"40px"}},[i("el-col",{attrs:{span:4}},[e._v(" ")]),e._v(" "),i("el-col",{staticStyle:{"text-align":"left",height:"60px","line-height":"60px","border-top":"1px solid lightgray","border-bottom":"1px solid lightgray"},attrs:{span:16}},[i("el-row",[i("el-col",{attrs:{span:6}},[i("el-button",{on:{click:e.openFullScreen}},[e._v("完成阅片")])],1),e._v(" "),i("el-col",{attrs:{span:6}},[i("el-button",{on:{click:e.backToUndiagnosed}},[e._v("完成并返回")])],1),e._v(" "),i("el-col",{attrs:{span:6}},[i("el-button",{on:{click:e.finishAndCreatePdf}},[e._v("完成并生成报告")])],1),e._v(" "),i("el-col",{attrs:{span:6}},[i("el-button",{on:{click:e.onlyBack}},[e._v("返回")])],1)],1)],1),e._v(" "),i("el-col",{attrs:{span:4}})],1):e._e(),e._v(" "),e.finishSeen?i("el-row",{staticStyle:{"margin-top":"20px",height:"40px","line-height":"40px"}},[i("el-col",{attrs:{span:4}},[e._v(" ")]),e._v(" "),i("el-col",{staticStyle:{"text-align":"left",height:"60px","line-height":"60px","border-top":"1px solid lightgray","border-bottom":"1px solid lightgray"},attrs:{span:16}},[i("el-row",[i("el-col",{attrs:{span:8}},[i("el-button",{on:{click:e.onlyBack}},[e._v("返回")])],1),e._v(" "),i("el-col",{attrs:{span:8}},[i("el-button",{on:{click:e.createReport}},[e._v("生成报告")])],1),e._v(" "),i("el-col",{attrs:{span:8}},[e._v(" ")])],1)],1),e._v(" "),i("el-col",{attrs:{span:4}})],1):e._e()],1),e._v(" "),i("el-dialog",{attrs:{title:"请输入随访时间",visible:e.dialogVisible,"show-close":!1,width:"30%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[i("div",{staticClass:"block"},[i("el-date-picker",{attrs:{align:"right",type:"date","value-format":"yyyy-MM-dd",placeholder:"选择日期","picker-options":e.pickerOptions},model:{value:e.value2,callback:function(t){e.value2=t},expression:"value2"}})],1),e._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"primary"},on:{click:e.confirmSelectDate}},[e._v("确 定")])],1)]),e._v(" "),i("el-dialog",{attrs:{title:"请输入医院名称",visible:e.uplevelVisible,width:"30%"},on:{"update:visible":function(t){e.uplevelVisible=t}}},[i("div",{staticClass:"block"},[i("el-form",[i("el-form-item",{attrs:{label:"医院名称"}},[i("el-input",{attrs:{"auto-complete":"off",placeholder:"请输入医院名称(限制字数20以内)",maxlength:"20"},model:{value:e.uplevelHospital,callback:function(t){e.uplevelHospital=t},expression:"uplevelHospital"}})],1)],1)],1),e._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:e.cancelInputHospital}},[e._v("取 消")]),e._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:e.confirmInputHospital}},[e._v("确 定")])],1)]),e._v(" "),i("el-dialog",{attrs:{title:"提示",visible:e.centerDialogVisible,width:"30%",center:""},on:{"update:visible":function(t){e.centerDialogVisible=t}}},[i("span",[e._v("生成报告失败")]),e._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"primary"},on:{click:function(t){e.centerDialogVisible=!1}}},[e._v("确 定")])],1)])],1)},staticRenderFns:[]};var W=i("VU/8")(H,M,!1,function(e){i("fANo")},"data-v-03985e7e",null).exports,q=S.a.url,U={data:function(){return{userName:"",parseWord:"",parseWord2:"",autoLogin:!1,error:!1,userNameError:"",parseWordError:"",hospital_id:0,checked:!1,registerSeen:!1,forgetSeen:!1,loginSeen:!0,generalSeen:!0,activeName:"first",isActive:!1,email:"",reset_email:"",forgetPwdValue:"立即发送 >",isAble:!1}},created:function(){document.onkeydown=function(e){13==((e=e||(window.event?window.event:"")).keyCode?e.keyCode:e.which)&&(document.getElementById("jsLoginBtn").click(),event.returnValue=!1)},this.checked=this.$store.state.checked,this.userName=F.a.getCookie("loginName"),this.parseWord=F.a.getCookie("loginPwd")},mounted:function(){var e=window.innerHeight;document.getElementById("login").style.height=e+"px"},methods:{get_hospital_id:function(e){w.a.get(q+"/users/?username="+e).then(function(e){F.a.setCookie("hospital_id",e.data[0].hospital_id,7)}).catch(function(e){console.log(e)})},handleClick:function(){var e=this.activeName;this.error=!1,"first"===e?(this.loginSeen=!0,this.registerSeen=!1,this.generalSeen=!0,this.isActive=!1,this.forgetSeen=!1):"second"===e?(this.loginSeen=!1,this.forgetSeen=!1,this.generalSeen=!0,this.registerSeen=!0,this.isActive=!0):(this.forgetSeen=!0,this.loginSeen=!1,this.registerSeen=!1,this.isActive=!1,this.generalSeen=!1)},login:function(){var e=this,t=this;if(""!==this.userName)if(""!==this.parseWord){try{this.get_hospital_id(this.userName)}catch(e){console.log("the reason of failing to get hospital_id ",e)}Object(k.g)({username:this.userName,password:this.parseWord}).then(function(i){console.log(i),F.a.setCookie("name",e.userName,7),F.a.setCookie("token",i.token,7),e.checked?(F.a.setCookie("loginPwd",e.parseWord),F.a.setCookie("loginName",e.userName)):(F.a.delCookie("loginPwd"),F.a.delCookie("loginName")),t.$store.commit("setInfo",e.checked),t.$store.commit("login")}).catch(function(e){t.error="请核实账户或密码是否正确","non_field_errors"in e&&(t.error=e.non_field_errors[0]),"username"in e&&(t.userNameError=e.username[0]),"password"in e&&(t.parseWordError=e.password[0])})}else t.error="请输入密码";else t.error="请输入用户名"},register:function(){var e=this,t=this.userName,i=this.parseWord,a=this.parseWord2,n=this.email,r=/^[\u4E00-\u9FA5A-Za-z0-9_]+$/;return t?t.length<4?(this.error="用户名长度需4-10位",!1):i&&a?i.length<8?(this.error="密码长度至少8位",!1):n?/^([\.a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(\.[a-zA-Z0-9_-])+/.test(n)?i!==a?(this.error="两次密码不一致!",!1):r.test(t)?r.test(i)&&r.test(a)?void Object(k.h)({username:t,email:n,password1:i,password2:a}).then(function(t){e.error=t.info}).catch(function(e){}):(this.error="密码框禁止输入空格等特殊字符",!1):(this.error="用户名禁止输入空格等特殊字符!",!1):(this.error="邮箱格式不正确",!1):(this.error="请输入邮箱",!1):(this.error="请输入密码",!1):(this.error="用户名不能为空!",!1)},errorUnshow:function(){this.error=!1},forgetPwd:function(){var e=this,t=this.reset_email,i=window.location.href;console.log(i);var a=i.split("templates")[0];return t?/^([\.a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(\.[a-zA-Z0-9_-])+/.test(t)?(this.sendCode(),void Object(k.f)({email:t,url:a}).then(function(t){e.error=2===t?"发送成功,请登陆邮箱修改密码":0===t?"该邮箱未被注册,请核实":"发送失败,请联系管理员"}).catch(function(e){})):(this.error="邮箱格式不正确",!1):(this.error="请输入邮箱",!1)},sendCode:function(){var e=this,t=60;this.isAble=!0;var i=setInterval(function(){t--,console.log(t),e.forgetPwdValue=t+"秒后可重新发送",0===t&&(clearInterval(i),e.isAble=!1,e.forgetPwdValue="立即发送 >")},1e3)}}},J={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"c-box bg-box",attrs:{id:"login"}},[a("div",{staticClass:"login-box clearfix",staticStyle:{"margin-top":"10px"}},[a("div",{staticClass:"fr form-box",class:{register_form_box:e.isActive}},[a("el-header",{staticStyle:{"margin-bottom":"10px","margin-top":"20px"}},[a("img",{staticStyle:{height:"50px",width:"194px"},attrs:{id:"logoImg",src:i("FS2f"),alt:""}})]),e._v(" "),[a("el-tabs",{on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:"立即登录",name:"first"}}),e._v(" "),a("el-tab-pane",{attrs:{label:"立即注册",name:"second"}}),e._v(" "),a("el-tab-pane",{attrs:{label:"忘记密码",name:"third"}})],1)],e._v(" "),a("el-form",{attrs:{id:"jsLoginForm",autocomplete:"on"}},[a("input",{attrs:{type:"hidden",name:"csrfmiddlewaretoken",value:"ywSlOHdiGsK6VFB6iyhnB1B30khmz8SU"}}),e._v(" "),e.generalSeen?a("div",{staticClass:"form-group marb20"},[a("label",[e._v("用 户 名")]),e._v(" "),a("input",{directives:[{name:"model",rawName:"v-model",value:e.userName,expression:"userName"}],attrs:{name:"account_l",id:"account_l",type:"text",oninput:"value=value.replace(/[\\W]/g,'')",maxlength:"10",placeholder:"支持数字和字母(4-10位)"},domProps:{value:e.userName},on:{focus:e.errorUnshow,input:function(t){t.target.composing||(e.userName=t.target.value)}}})]):e._e(),e._v(" "),a("p",{directives:[{name:"show",rawName:"v-show",value:e.userNameError,expression:"userNameError"}],staticClass:"error-text"},[e._v(e._s(e.userNameError))]),e._v(" "),e.generalSeen?a("div",{staticClass:"form-group marb8"},[a("label",[e._v("密     码")]),e._v(" "),a("input",{directives:[{name:"model",rawName:"v-model",value:e.parseWord,expression:"parseWord"}],attrs:{name:"password_l",id:"password_l",type:"password",maxlength:"10",placeholder:"请输入您的密码(8-10位)"},domProps:{value:e.parseWord},on:{focus:e.errorUnshow,input:function(t){t.target.composing||(e.parseWord=t.target.value)}}})]):e._e(),e._v(" "),e.registerSeen?a("div",{staticClass:"form-group marb8"},[a("label",[e._v("确认密码")]),e._v(" "),a("input",{directives:[{name:"model",rawName:"v-model",value:e.parseWord2,expression:"parseWord2"}],attrs:{name:"password_2",id:"password_2",type:"password",maxlength:"10",placeholder:"请确认您的密码"},domProps:{value:e.parseWord2},on:{focus:e.errorUnshow,input:function(t){t.target.composing||(e.parseWord2=t.target.value)}}})]):e._e(),e._v(" "),e.registerSeen?a("div",{staticClass:"form-group marb8"},[a("label",[e._v("邮     箱")]),e._v(" "),a("input",{directives:[{name:"model",rawName:"v-model",value:e.email,expression:"email"}],attrs:{name:"email",id:"email",type:"email",placeholder:"请输入您的邮箱"},domProps:{value:e.email},on:{focus:e.errorUnshow,input:function(t){t.target.composing||(e.email=t.target.value)}}})]):e._e(),e._v(" "),e.forgetSeen?a("div",{staticClass:"form-group marb8"},[a("label",[e._v("邮     箱")]),e._v(" "),a("input",{directives:[{name:"model",rawName:"v-model",value:e.reset_email,expression:"reset_email"}],attrs:{name:"email",id:"reset_email",type:"email",placeholder:"请输入您的注册邮箱"},domProps:{value:e.reset_email},on:{focus:e.errorUnshow,input:function(t){t.target.composing||(e.reset_email=t.target.value)}}})]):e._e(),e._v(" "),e.loginSeen?a("div",{staticStyle:{"text-align":"left"}},[a("el-checkbox",{model:{value:e.checked,callback:function(t){e.checked=t},expression:"checked"}},[e._v("记住密码")])],1):e._e(),e._v(" "),a("p",{directives:[{name:"show",rawName:"v-show",value:e.parseWordError,expression:"parseWordError"}],staticClass:"error-text"},[e._v(e._s(e.parseWordError))]),e._v(" "),a("div",{staticClass:"auto-box marb38"},[a("p",{directives:[{name:"show",rawName:"v-show",value:e.error,expression:"error"}],staticClass:"error-text"},[e._v(e._s(e.error))])]),e._v(" "),e.loginSeen?a("input",{staticClass:"btn btn-green",staticStyle:{outline:"none"},attrs:{id:"jsLoginBtn",type:"button",value:"立即登录 > "},on:{click:e.login}}):e._e(),e._v(" "),e.registerSeen?a("input",{staticClass:"btn btn-green",staticStyle:{outline:"none"},attrs:{id:"jsRegisterBtn",type:"button",value:"立即注册 > "},on:{click:e.register}}):e._e(),e._v(" "),e.forgetSeen?a("input",{staticClass:"btn btn-green",staticStyle:{outline:"none"},attrs:{id:"jsForgetPwdBtn",type:"button",value:this.forgetPwdValue,disabled:e.isAble},on:{click:e.forgetPwd}}):e._e()])],2)])])])},staticRenderFns:[]};var X=i("VU/8")(U,J,!1,function(e){i("sFiM")},"data-v-7fb31e84",null).exports;window.onresize=function(){var e=window.innerWidth-250,t=window.innerHeight;document.getElementById("rightNav").style.width=e+"px",document.getElementById("leftNav").style.height=t+"px"};var Z={name:"App",provide:function(){return{reload:this.reload}},created:function(){F.a.getCookie("token")?this.$store.commit("login"):this.$store.commit("logout")},mounted:function(){var e=window.innerWidth-250;document.getElementById("rightNav").style.width=e+"px"},methods:{reload:function(){var e=this;return s()(r.a.mark(function t(){var i,a,n;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(i=e.$store.state.undiagnosed,a=e.$store.state.diagnosed,n=e.$store.state.transform,!i){t.next=10;break}return e.$store.commit("clickDiagnosed"),t.next=7,e.$nextTick();case 7:e.$store.commit("clickUndiagnosed"),t.next=22;break;case 10:if(!a){t.next=17;break}return e.$store.commit("clickUndiagnosed"),t.next=14,e.$nextTick();case 14:e.$store.commit("clickDiagnosed"),t.next=22;break;case 17:if(!n){t.next=22;break}return e.$store.commit("clickUndiagnosed"),t.next=21,e.$nextTick();case 21:e.$store.commit("clickTransform");case 22:case"end":return t.stop()}},t,e)}))()}},components:{leftNav:u,topHeader:m,undiagnosed:v,diagnosed:T,transform:L,statistics:E,report:W,login:X},data:function(){return{seen:!1,msg:"Hello Vuex"}},store:l.a},Y={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"app"}},[e.$store.state.login?i("login"):e._e(),e._v(" "),e.$store.state.leftNav?i("leftNav",{staticClass:"leftNav",attrs:{id:"leftNav"}}):e._e(),e._v(" "),e.$store.state.leftNav?i("div",{staticClass:"main",attrs:{id:"rightNav"}},[i("router-view"),e._v(" "),e.$store.state.topHeader?i("topHeader"):e._e(),e._v(" "),e.$store.state.undiagnosed?i("undiagnosed"):e._e(),e._v(" "),e.$store.state.diagnosed?i("diagnosed"):e._e(),e._v(" "),e.$store.state.transform?i("transform"):e._e(),e._v(" "),e.$store.state.statistics?i("statistics"):e._e(),e._v(" "),e.$store.state.report?i("report"):e._e()],1):e._e()],1)},staticRenderFns:[]};var G=i("VU/8")(Z,Y,!1,function(e){i("+uEa")},null,null).exports,K=i("/ocq"),Q={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"hello"},[i("h1",[e._v(e._s(e.msg))]),e._v(" "),i("h2",[e._v("Essential Links")]),e._v(" "),e._m(0),e._v(" "),i("h2",[e._v("Ecosystem")]),e._v(" "),e._m(1)])},staticRenderFns:[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("ul",[i("li",[i("a",{attrs:{href:"https://vuejs.org",target:"_blank"}},[e._v("\n        Core Docs\n      ")])]),e._v(" "),i("li",[i("a",{attrs:{href:"https://forum.vuejs.org",target:"_blank"}},[e._v("\n        Forum\n      ")])]),e._v(" "),i("li",[i("a",{attrs:{href:"https://chat.vuejs.org",target:"_blank"}},[e._v("\n        Community Chat\n      ")])]),e._v(" "),i("li",[i("a",{attrs:{href:"https://twitter.com/vuejs",target:"_blank"}},[e._v("\n        Twitter\n      ")])]),e._v(" "),i("br"),e._v(" "),i("li",[i("a",{attrs:{href:"http://vuejs-templates.github.io/webpack/",target:"_blank"}},[e._v("\n        Docs for This Template\n      ")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("ul",[t("li",[t("a",{attrs:{href:"http://router.vuejs.org/",target:"_blank"}},[this._v("\n        vue-router\n      ")])]),this._v(" "),t("li",[t("a",{attrs:{href:"http://vuex.vuejs.org/",target:"_blank"}},[this._v("\n        vuex\n      ")])]),this._v(" "),t("li",[t("a",{attrs:{href:"http://vue-loader.vuejs.org/",target:"_blank"}},[this._v("\n        vue-loader\n      ")])]),this._v(" "),t("li",[t("a",{attrs:{href:"https://github.com/vuejs/awesome-vue",target:"_blank"}},[this._v("\n        awesome-vue\n      ")])])])}]};i("VU/8")({name:"HelloWorld",data:function(){return{msg:"Welcome to Your Vue.js App"}}},Q,!1,function(e){i("b3gb")},"data-v-21836a9c",null).exports;var ee={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",[this._v("this is register page\n  "),t("router-view")],1)},staticRenderFns:[]};i("VU/8")({name:"register"},ee,!1,function(e){i("8xBN")},"data-v-268134f5",null).exports;a.default.use(K.a);var te=new K.a({routes:[]}),ie=i("zL8q"),ae=i.n(ie);i("tvR6"),i("7t+N");a.default.config.productionTip=!1,a.default.use(ae.a),new a.default({el:"#app",router:te,components:{App:G},template:"<App/>"})},O2WP:function(e,t,i){"use strict";t.a={url:"http://202.38.71.181:8000/"}},P9l9:function(e,t,i){"use strict";var a=i("mtWM"),n=i.n(a),r=i("mvHQ"),o=i.n(r),s=i("Dd8w"),l=i.n(s),c=i("//Fk"),d=i.n(c),u=i("u4WU"),p=i("7+uW"),g=i("O2WP"),m=g.a.url,h=new p.default,_=n.a.create({baseURL:m,timeout:5e3});_.interceptors.request.use(function(e){var t=u.a.getCookie("token");return console.log("拦截中",t),null===t?(h.$message("登陆过期,即将返回登陆页面"),setTimeout("window.location.reload()",2e3),d.a.reject(error)):("post"===e.method?e.data=l()({},e.data):e.params=l()({},e.params),e.headers["Content-Type"]="application/x-www-form-urlencoded",e)},function(e){return h.$message(e),d.a.reject(e)}),_.interceptors.response.use(function(e){return console.log(e.data),e.data,e.data},function(e){console.log("error"),console.log(e),console.log(o()(e));var t=404===o()(e).status?"404":"操作异常";return console.log(t),d.a.reject(e)});var f=_;i.d(t,"g",function(){return b}),i.d(t,"h",function(){return y}),i.d(t,"f",function(){return x}),i.d(t,"j",function(){return w}),i.d(t,"b",function(){return k}),i.d(t,"i",function(){return F}),i.d(t,"d",function(){return S}),i.d(t,"e",function(){return D}),i.d(t,"a",function(){return C}),i.d(t,"c",function(){return V});var v=g.a.url,b=function(e){return n.a.post(v+"login",e).then(function(e){return e.data})},y=function(e){return n.a.post(v+"operation/register/",e).then(function(e){return e.data})},x=function(e){return n.a.post(v+"operation/forgetPwd/",e).then(function(e){return e.data})},w=function(e){return n.a.post(v+"operation/sendSms/",e).then(function(e){return e.data})},k=function(e){return f({url:"operation/check/",method:"post",data:e})},F=function(e){return f({url:"operation/remove/",method:"post",data:e})},S=function(e){return f({url:"operation/editBasicInfo/",method:"post",data:e})},D=function(e){return f({url:"operation/editReviewInfo/",method:"post",data:e})},C=function(e){return f({url:"operation/add/",method:"post",data:e})},V=function(e){return f({url:"operation/clickDiagnoseButton/",method:"post",data:e})}},T5vU:function(e,t){},UG1C:function(e,t){},YtJ0:function(e,t,i){"use strict";var a=i("7+uW"),n=i("NYxO"),r=i("u4WU");a.default.use(n.a);var o={clickUndiagnosed:function(e){e.undiagnosed=!0,e.diagnosed=!1,e.transform=!1,e.statistics=!1,e.report=!1},clickDiagnosed:function(e){e.undiagnosed=!1,e.diagnosed=!0,e.transform=!1,e.statistics=!1,e.report=!1},clickStatistics:function(e){e.undiagnosed=!1,e.diagnosed=!1,e.transform=!1,e.report=!1,e.statistics=!0},clickTransform:function(e){e.undiagnosed=!1,e.diagnosed=!1,e.transform=!0,e.statistics=!1,e.report=!1},clickReport:function(e,t){e.undiagnosed=!1,e.diagnosed=!1,e.transform=!1,e.statistics=!1,e.report=!0,e.patient_info=t},backToUndiagnosed:function(e){e.undiagnosed=!0,e.diagnosed=!1,e.transform=!1,e.statistics=!1,e.report=!1},rememberPageAndSize:function(e,t){e.page_info=t},setInfo:function(e,t){e.user_info={name:r.a.getCookie("name"),token:r.a.getCookie("token")},e.checked=t,console.log("checked",t)},saveHospitalId:function(e,t){e.hospital_id=t,console.log("state.hospital",t)},login:function(e){e.undiagnosed=!0,e.diagnosed=!1,e.transform=!1,e.statistics=!1,e.report=!1,e.leftNav=!0,e.topHeader=!0,e.login=!1,e.user_info={name:r.a.getCookie("name"),token:r.a.getCookie("token")}},logout:function(e){e.undiagnosed=!1,e.diagnosed=!1,e.transform=!1,e.statistics=!1,e.report=!1,e.leftNav=!1,e.topHeader=!1,e.login=!0,e.page_info={currentPage:1,page_size:10},r.a.delCookie("token"),r.a.delCookie("name"),r.a.delCookie("hospital_id"),e.user_info={name:r.a.getCookie("name"),token:r.a.getCookie("token")}},changeFlag:function(e,t){e.flag=t}};t.a=new n.a.Store({state:{patient_info:{},page_info:{},user_info:{},undiagnosed:!1,diagnosed:!1,transform:!1,statistics:!1,report:!1,leftNav:!1,topHeader:!1,login:!0,hospital_id:0,checked:!1,flag:!1},mutations:o})},b3gb:function(e,t){},fANo:function(e,t){},o0QZ:function(e,t){},sFiM:function(e,t){},tvR6:function(e,t){},u4WU:function(e,t,i){"use strict";var a={setCookie:function(e,t,i){var a=new Date;a.setTime(a.getTime()+i),a.setDate(a.getDate()+i),document.cookie=e+"="+escape(t)+(null==i?"":";expires="+a.toGMTString())},getCookie:function(e){var t,i=new RegExp("(^| )"+e+"=([^;]*)(;|$)");return(t=document.cookie.match(i))?t[2]:null},delCookie:function(e){var t=new Date;t.setTime(t.getTime()-1),null!=a.getCookie(e)&&(document.cookie=e+"=; expires=Thu, 01 Jan 1970 00:00:01 GMT;"),console.log("delete successfully")}};t.a=a},vBAv:function(e,t){}},["NHnr"]);
//# sourceMappingURL=app.f6e35dcfa41cfe3db7c7.js.map